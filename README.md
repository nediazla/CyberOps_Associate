[![GitHub sponsors](https://undergroundwires.dev/img/badges/donate/flat.svg)](https://www.buymeacoffee.com/nediazla3)
# El Peligro

## Historias de guerra

Los actores de amenazas pueden secuestrar sesiones bancarias y otra información personal mediante el uso de puntos de acceso "gemelos malvados". Los actores de amenazas pueden dirigirse a las empresas, como en el ejemplo donde abrir un pdf en el equipo de la empresa puede instalar ransomware. Las naciones enteras pueden ser atacadas. Esto ocurrió en el ataque de malware Stuxnet.

## Agentes de amenazas

Los actores maliciosos incluyen, entre otros, a aficionados, hacktivistas, grupos del crimen organizado, agentes patrocinados por el estado y grupos terroristas. El aficionado puede tener poca o ninguna habilidad y a menudo utiliza la información que se encuentra en Internet para lanzar ataques. Los hacktivistas son hackers que protestan contra una variedad de ideas políticas y sociales. 

Gran parte de la actividad de los hackers es en busca de beneficios financieros. Los estados de una nación también están interesados en utilizar el ciberespacio para espionaje industrial. El robo de la propiedad intelectual puede otorgar una ventaja significativa a un país en el comercio internacional. 

A medida que el Internet de las cosas (Internet of Things, IoT) se expande, las cámaras web, los routers y otros dispositivos en nuestros hogares también están bajo ataque.

## Impacto de la amenaza

Se estima que los negocios perderán cerca de $5 trillones anualmente hasta el 2024 por ciberataques La información de identificación personal (Personal Identificable Information, PII), la información de salud protegida (Personald Health Information, PHI) y la información de seguridad personal (Personal Security Information, PSI) son formas de información protegida que a menudo se roban. Una empresa puede perder su ventaja competitiva cuando se roba esta información, incluidos los secretos comerciales. Además, los clientes pierden la confianza en la capacidad de la empresa para proteger sus datos. Los gobiernos también han sido víctimas de hackeos.

# Combatientes en la guerra contra la ciberdelincuencia

## El centro de operaciones de seguridad moderno

Los elementos principales del SOC incluyen personas, procesos y tecnologías. Los roles de trabajo son rápidamente envueltos e incluidos en niveles basados en la habilidad y experiencia. Estos roles incluyen un analista de alertas de nivel 1, un respondedor de incidentes de nivel 2, un cazador de amenazas de nivel 3 y un administrador de SOC. Un analista de nivel 1 monitoreará incidentes, abrirá tiquetes, y desarrollará mitigación básica de amenazas.

Los sistemas SEIM se utilizan para recopilar y filtrar datos, detectar y clasificar amenazas y analizar e investigar amenazas. SIEM y SOAR son normalmente emparejados juntos SOAR es similar a SIEM. 

SOAR va un paso más allá integrando inteligencia de amenazas y automatizando la investigación de incidentes y responde a flujos de trabajo basados en playbooks desarrollados por el equipo de seguridad. Los Indicadores clave de Rendimiento (Key Performance Indicators) (KPI) son ideados para manejar diferentes aspectos del desempeño de SOC. Las métricas comunes incluyen el tiempo de permanencia, el Tiempo Medio para Detectar (MTTD), el Tiempo Medio para Responder (MTTR), el Tiempo Medio para Contener (MTTC) y el Tiempo para Controlar.

Debe haber un equilibrio entre la seguridad y la disponibilidad de las redes. La seguridad no puede ser tan fuerte que interfiera con los empleados o las funciones comerciales.

## Convertirse en un defensor

Una variedad de certificaciones de ciberseguridad que son relevantes para carreras en SOC están disponibles en diferentes organizaciones. Estas incluyen Certificación Cisco CyberOps Associate, Certificación Analítica CompTIAA Cybersecurity, (ISC)2 Information Security Certifications, Global Information Assurance Certification (GIAC), y otros. Los sitios de trabajo incuyen Indeed.com, CarerBuilder.com;USAJobs.gov, Glassdoor, y LinkedIn. También puede considerar internamientos y agencias temporales para ganar experiencia y comenzar su carrera. Adicionalmente, Linux y Paython añadirán habilidades para un mejor atractivo en el campo laboral.

# Sistema Operativo Windows

## Historia de Windows

Los primeros equipos necesitaban un sistema operativo de disco (DOS) para crear y administrar archivos. Microsoft desarrolló MS-DOS como una interfaz de línea de comandos (CLI) para acceder a la unidad de disco y cargar los archivos del sistema operativo. Las primeras versiones de Windows constaban de una interfaz gráfica de usuario (GUI) que se ejecutaba en MS-DOS. Sin embargo, las versiones modernas de Windows controlan directamente la computadora y su hardware y admiten múltiples procesos de usuario. Esto es muy diferente del proceso individual de un solo usuario de MS-DOS. Desde el año 1993 hubo más de 20 versiones de Windows basadas en el sistema operativo NT. Los usuarios utilizan una GUI de Windows para trabajar con archivos de datos y software. La GUI tiene un área principal que se conoce como escritorio y una barra de tareas situada debajo del escritorio. La barra de tareas incluye el menú Inicio, elementos de inicio rápido y área de notificaciones. Windows tiene muchas vulnerabilidades. Las recomendaciones para proteger el sistema operativo Windows incluyen el uso de protección contra virus o malware, el uso de contraseñas seguras, el uso de firewall y el uso limitado de la cuenta de administrador, entre otras.

## Arquitectura y Operaciones de Windows

Windows consta de una capa de abstracción de hardware (Hardware Abstraction Layer, HAL) que es un software que maneja toda la comunicación entre el hardware y el kernel. El núcleo tiene control sobre toda la computadora y maneja las solicitudes de entrada y salida, la memoria y todos los periféricos conectados a la computadora. Windows funciona en dos modos diferentes. El primero es el modo de usuario. Muchos programas de Windows se ejecutan en modo usuario El segundo es el modo kernel. Permite el acceso directo del código del sistema operativo al hardware del ordenador. 

Windows admite varios sistemas de archivos diferentes, pero NTFS es el más utilizado. Los volúmenes NTFS incluyen el sector de arranque de partición, la tabla maestra de archivos, los archivos del sistema y el área de archivos. Cuando un equipo arranca, primero accede a la información del sistema y al código que se almacena en el hardware del BIOS. El código de arranque del BIOS realiza una prueba del sistema denominada POST, localiza y carga el sistema operativo Windows y carga otros programas asociados para iniciar el sistema operativo. Windows siempre debe estar apagado correctamente.

Una computadora funciona almacenando las instrucciones en la memoria RAM hasta que la CPU las procesa. Cada proceso en una computadora con Windows de 32 bits admite un espacio para la dirección postal virtual que hace posible manipular hasta 4 GB. Cada proceso de una computadora con Windows de 64 bits admite un espacio de direcciones virtuales de hasta 8 terabytes. Windows almacena toda la información sobre el hardware, las aplicaciones, los usuarios y la configuración del sistema en una extensa base de datos conocida como el Registro. El registro es una base de datos jerárquica donde el nivel más alto se conoce como subárbol, debajo están las claves y, luego, las subclaves. Hay cinco colmenas de registro que contienen datos respecto a la configuración y el funcionamiento de Windows. Hay cientos de claves y subclaves.

## Configuración y monitoreo de Windows

Por razones de seguridad, no es recomendable iniciar sesión en Windows utilizando la cuenta de administrador o una cuenta con privilegios administrativos. No otorgue privilegios administrativos a los usuarios estándar. No habilite la cuenta Invitados a menos que el equipo vaya a ser utilizado por muchas personas diferentes que no tienen cuentas. Utilice grupos de Windows para facilitar la administración de usuarios. Los usuarios y grupos locales se administran con el applet del panel de control lusrmgr.msc.

Puede utilizar la CLI o Windows PowerShell para ejecutar comandos. PowerShell se puede utilizar para crear scripts para automatizar tareas que la CLI normal no puede automatizar. Windows Management Instrumentation (WMI) se utiliza para administrar computadoras remotas. El comando **net** se puede combinar con conmutadores para centrarse en una salida específica. El Administrador de Tareas provee mucha información sobre lo que se está ejecutando y el rendimiento en general de la computadora. El Monitor de recursos provee información detallada acerca del uso de recursos El Centro de Redes y Recursos Compartidos es utilizado para configurar la propiedades de las redes de Windows y probar las configuraciones de la red. El protocolo de bloqueo de mensaje del servidor (SMB) se utiliza para compartir recursos de la red como archivos en dispositivos remotos. Para conectar recursos se utiliza el formato Convención de nomenclatura universal (UNC). Windows Server es una edición de Windows que es usada principalmente en centros de datos. Proporciona servicios de red, archivos, web y administración a una red o dominio de Windows.

## Seguridad de Windows

El malware puede abrir puertos de comunicación para comunicarse y propagarse. El comando de Windows **netstat** muestra todos los puertos de comunicación abiertos en un equipo y también puede mostrar los procesos de software asociados con los puertos. Esto permite identificar y apagar el software potencialmente malicioso desconocido. El Visor de sucesos de Windows proporciona acceso a numerosos eventos registrados en relación con el funcionamiento de un equipo. Windows registra eventos de Windows y eventos de aplicaciones y servicios. Los niveles de gravedad de eventos registrados varían a través de los niveles de información, advertencia, error o niveles críticos. Es muy importante mantener Windows actualizado para protegerse contra nuevas amenazas de seguridad. Los parches de software, las actualizaciones y los paquetes de servicios abordan las vulnerabilidades de seguridad a medida que se descubren. Windows debe configurarse para que descargue e instale automáticamente las actualizaciones a medida que estén disponibles. 

Windows se puede configurar para que solo instale y reinicie un equipo a las horas especificadas del día.

# Descripción General de Linux

## Nociones Básicas de Linux

Linux es un sistema operativo de código abierto rápido, fiable y pequeño. Requiere algunos recursos de hardware para ejecutarse y tiene muchas opciones para ser personalizado. Está diseñado para ser utilizado en redes. El kernel de Linux es distribuido por diferentes organizaciones con diferentes herramientas y paquetes de software. Una versión personalizada de Linux que se denomina Cebolla de Seguridad contiene software y herramientas diseñadas para su uso en la supervisión de seguridad de red por analistas de ciberseguridad. Kali Linux es otra distribución personalizada de Linux que tiene numerosas herramientas diseñadas para pruebas de penetración de seguridad de red.

## Trabajando en el Shell de Linux

En Linux, el usuario se comunica con el sistema operativo a través de una GUI o una interfaz de línea de comandos (CLI), o shell. Si se está ejecutando una GUI, se accede al shell a través de la aplicación terminal, como xterm o gnome terminal. Los comandos de Linux son programas que realizan una tarea especifica. El comando **man**, seguido de un comando específico, proporciona documentación para ese comando. Es importante conocer al menos comandos básicos de Linux, comandos de archivos y directorios, y comandos para trabajar con archivos de texto. En Linux, todo se trata como un archivo; esto incluye la memoria, los discos, el monitor y los directorios.

## Servidores y Clientes de Linux

Los servidores son computadoras que tienen un software instalado que les permite proporcionar servicios a las computadoras cliente a través de la red. Algunos servicios proporcionan acceso a recursos externos como archivos, correos electrónicos y paginas web, para los clientes que lo soliciten. Otros servicios se ejecutan de manera interna y realizan tareas como la administración de registros, administración de memoria o escaneo de disco. Para permitir que un equipo proporcione varios servicios, se utilizan puertos. Un puerto es un recurso de red reservado que «escucha» las solicitudes de los clientes. Aunque se puede configurar el número de puerto que utiliza un servicio, la mayoría de los servicios escuchan en puertos predeterminados «conocidos». Las aplicaciones con software de cliente estan designadas a comunicar con un tipo especifico de servidor. Los exploradores web están diseñados para comunicarse con servidores web mediante el protocolo HTTP en el puerto 80. Los clientes FTP se comunican con servidores FTP para transferir archivos.

## Administración Básica del Servidor

En Linux, los servidores se administran por medio de archivos de configuración. Varios ajustes se pueden modificar y guardar en archivos de configuración. Cuando se inicia un servicio, examina sus archivos de configuración para saber cómo debe ejecutarse. No hay ninguna regla para la forma en que se escriben los archivos de configuración. El formato del archivo de configuración depende del creador del software del servidor. Los dispositivos Linux deben protegerse utilizando métodos probados para proteger el dispositivo y el acceso administrativo. Esto se conoce como dispositivos de endurecimiento. Una forma de endurecer un dispositivo es mantener contraseñas, configurar funciones de inicio de sesión mejoradas e implementar un inicio de sesión remoto seguro con SSH. 

También es muy importante mantener el sistema operativo actualizado. Otras formas de endurecer un dispositivo son forzar cambios periódicos de contraseña, imponer contraseñas seguras y evitar la reutilización de contraseñas. Finalmente, los clientes y servidores Linux utilizan archivos de registro para registrar el funcionamiento del sistema y eventos importantes. Se mantienen varios archivos de registro diferentes, incluidos registros de aplicaciones, registros de eventos, registros de servicio y registros del sistema. Los registros del servidor registran las actividades que realizan los usuarios remotos que acceden a los servicios del sistema. Es importante conocer la ubicación de los diferentes registros en el sistema de archivos Linux para que puedan ser accedidos y monitoreados en busca de problemas.

## El sistema de archivos Linux

Linux soporta una serie de sistemas de archivos diferentes que varían según la velocidad, la flexibilidad, la seguridad, el tamaño, la estructura, la lógica y mucho más. Algunos de los sistemas de archivos que son compatibles con Linux son ext2, ext3, ext4, NFS y CDFS. Los sistemas de archivos se montan en particiones y se accede a través de puntos de montaje o directorios. Las letras de unidad de Windows son ejemplos de puntos de montaje. El **mount** comando se puede utilizar para mostrar detalles de los sistemas de archivos que están actualmente montados en un equipo Linux. El sistema de archivos raíz está representado por el símbolo «**/**». Contiene todos los archivos del equipo de forma predeterminada. Linux utiliza permisos de archivos para controlar a quién se le permite tener diferentes tipos de acceso a archivos y directorios. Los permisos incluyen read (r), write (w) y execute (x). Los archivos y directorios tienen permisos asignados a usuarios, grupos y otros. Los permisos para archivos y carpetas se muestran con el comando **ls -l**. Este comando también muestra los vínculos de un archivo. Los enlaces rígidos crean otro archivo con un nombre diferente que está enlazado al mismo lugar en el sistema de archivos. El propietario del archivo y el grupo del archivo también se muestran junto con la fecha y hora de la última modificación del archivo. Los permisos de archivo son características potentes del sistema de archivos Linux y no se pueden violar. Solo el usuario raíz puede anular permisos de archivos. Debido a la potencia del usuario raíz, el acceso raíz debe controlarse cuidadosamente. Los vínculos duros se crean con el **ln** comando. Los cambios en uno de los archivos vinculados de forma rígida también se realizan en el archivo original. Los vínculos simbólicos, o enlaces simbólicos, son similares a los vínculos duros, ya que un cambio en el archivo vinculado se refleja en el archivo original. Los enlaces simbólicos tienen varias ventajas sobre los enlaces duros.

## Trabajando con la GUI de Linux

El sistema X Windows, o X11, es un marco de software básico que incluye funciones para crear, controlar y configurar una GUI de Windows en una interfaz de apuntar y hacer clic. Diferentes proveedores utilizan el sistema X Windows para crear diferentes GUI de administrador de Windows para Linux. Ejemplos de gestores de ventanas son Gnome y KDE. La distribución Ubuntu Linux utiliza Gnome 3 de forma predeterminada. El escritorio de Gnome 3 consta del menú de aplicaciones, el Dock de Ubuntu, la barra superior, el calendario y la bandeja de mensajes del sistema, el área de actividades y el menú de estado.

## Trabajando en un host Linux

Para instalar aplicaciones en hosts Linux, se usan programas llamados administradores de paquetes. Los paquetes son aplicaciones de software y todos sus archivos auxiliares. Los administradores de paquetes son extremadamente útiles para instalar aplicaciones de software complejas desde repositorios de paquetes centralizados a los que se puede acceder a través de Internet. Diferentes distribuciones Linux utilizan diferentes gestores de paquetes. Por ejemplo, Arch Linux usa **pacman**, Debian usa **dpkg** como gestor de paquetes base y **apt** para comunicarse con **dpkg**. Ubuntu también usa **apt**. Los comandos CLI del administrador de paquetes se utilizan para instalar, quitar y actualizar paquetes de software. Los comandos de actualización actualizan todos los paquetes instalados actualmente. La gestión de paquetes también se puede realizar en una GUI. Los procesos de software son instancias de programas informáticos que se están ejecutando. Sistema de operaciones multitarea puede ejecutar mucho procesos al mismo tiempo. Bifurcación es un método que utiliza el kernel para permitir que un proceso cree una copia de sí mismo. El **ps** comando enumera los procesos en ejecución, **top** muestra información sobre los procesos en ejecución dinámicamente y **kill** se utiliza para quitar, reiniciar o pausar los procesos en ejecución. Aunque se considera que Linux está mejor protegido contra software malicioso (malware) que otros sistemas operativos, sigue siendo susceptible a troyanos, gusanos y otros tipos de malware. Linux suele ser atacado a través de sus servicios y procesos. El software obsoleto a menudo es vulnerable a ataques. Los actores de amenazas pueden sondear un dispositivo en busca de puertos abiertos vinculados a procesos de servidor obsoletos. Con este conocimiento, se pueden lanzar ataques. Es importante mantener actualizado el sistema operativo y sus componentes y aplicaciones. El **chkrootkit** programa está diseñado para detectar malware rootkit. Los Rootkits son programas de malware de nivel profundo que son muy difíciles de detectar y eliminar. Pueden cambiar el funcionamiento fundamental del sistema operativo en sí y se pueden usar para crear acceso no autorizado a los sistemas. Los comandos de tuberías utilizan el símbolo «|» para encadenar diferentes comandos utilizando la salida de un comando como entrada para otro.

# Protocolos de Red

## Comunicaciones de red

Las redes vienen en todos los tamaños y se pueden encontrar en hogares, negocios y otras organizaciones. El Internet es la red más extensa que existe. Todos los equipos que se conectan a una red se conocen como hosts o dispositivos finales. Gran parte de la interacción entre dispositivos terminales es tráfico entre cliente y servidor. Los hosts pueden funcionar como clientes o servidores o como clientes y servidores en redes de punto a punto. Los servidores son hosts que utilizan software especializado para permitirles responder a las solicitudes de diferentes tipos de datos de los clientes. Los clientes son hosts que utilizan aplicaciones de software como exploradores web, clientes de correo electrónico o aplicaciones de transferencia de archivos para solicitar datos de servidores. Cuando usamos Internet, utilizamos una combinación de cables de cobre y fibra óptica o comunicaciones inalámbricas y satelitales para transportar nuestro tráfico de datos. Las conexiones a Internet se realizan a través de proveedores de servicios de Internet que se conectan entre sí mediante ISP globales de nivel 1 y nivel 2 que se conectan entre sí a través de puntos de intercambio de Internet (IXP). Las empresas más grandes pueden conectarse a ISP de nivel 2 a través de un punto de presencia (POP). Los ISP de nivel 3 conectan hogares y empresas a Internet. El tráfico entre una computadora y un servidor de Internet puede tomar muchas rutas diferentes. Algunos caminos pueden ser muy directos, pero otros pueden parecer salir fuera del camino. Además, los datos que se envían entre un equipo y un servidor se pueden enviar en una ruta diferente de la en la que se reciben.

## Protocolos de Comunicación

Las comunicaciones de datos requieren algo más que conexiones. Los dispositivos deben saber cómo comunicarse. Para estos dispositivos utilizan reglas o protocolos de comunicación, al igual que las comunicaciones cara a cara entre personas usan reglas. Los protocolos de red especifican muchas características de la comunicación de red, como codificación de mensajes, formato y encapsulación de mensajes, tamaño de mensaje, sincronización de mensajes y opciones de entrega. 

Algunos de los protocolos de red más comunes son Hypertext Transfer Protocol (HTTP), el protocolo de control de transmisión (TCP) y el protocolo de Internet (IP). Es muy importante que un analista de ciberseguridad conozca la estructura de los datos del protocolo y cómo funcionan los protocolos en la red. Los protocolos especifican cómo se estructuran los mensajes y la forma en que los dispositivos de red comparten información sobre rutas a otras redes. Especificar cómo y cuándo se transmiten los mensajes de error y del sistema entre dispositivos. Además, los protocolos especifican cómo se configuran y terminan las sesiones de transferencia de datos. El conjunto de protocolos TCP/IP es utilizado por Internet y redes de datos en hogares, empresas y otras organizaciones. La suite TCP/IP es una familia de protocolos que se ajustan a los estándares de código abierto disponibles gratuitamente que están avalados por la industria de redes y aprobados por organizaciones de estándares. Esto permite que los dispositivos de diferentes fabricantes trabajen juntos. El conjunto de protocolos TCP/IP tiene cuatro capas de protocolos que funcionan juntos cuando se envían y reciben mensajes. Los protocolos comunes en la capa de aplicación de la suite son DNS, DHCP, POP3 y HTTPS, entre otros. Los protocolos de la capa de transporte son TCP y UDP. 

Ejemplos de protocolos de capa de Internet son IPv4, IPv6, ICMP y EIGRP. Los mensajes están formateados para ajustarse a los estándares de protocolos. Los datos de protocolo se encapsulan colocando datos de capa superior dentro de los datos de capa inferior cuando se envían los datos. El proceso inverso se produce cuando se reciben los datos. Los estándares de protocolo especifican el tamaño de los mensajes y cómo se codifican los mensajes para enviarlos a través de conexiones de red como ondas de radio, pulsos de luz o señales eléctricas. El host receptor decodifica los mensajes. 

Las normas de protocolo también especifican la velocidad a la que se envían los datos (control de flujo), el tiempo que espera un host para recibir una respuesta desde el destino (tiempo de espera de respuesta) y la forma en que los hosts determinan cuándo pueden enviar datos en una red de medios compartidos (método de acceso). Los mensajes de unidifusión se envían a un host de destino. Los mensajes de multidifusión se envían a un grupo de hosts. Las transmisiones se envían a todos los hosts de la misma área de la red. Los modelos de comunicación en capas tienen una serie de beneficios. Los modelos ayudan en el diseño de protocolos y dispositivos. También aumentan la competencia entre fabricantes porque los dispositivos deben trabajar juntos. Por último, los modelos evitan que los cambios en una capa afecten a otras capas y proporcionan una forma común de describir el funcionamiento de la red. Dos modelos son los modelos de referencia OSI y TCP/IP. El modelo de OSI tiene siete capas. Las diferentes capas tienen diferentes funciones. El modelo TCP/IP incluye cuatro capas.

## Encapsulamiento de datos

Los mensajes que consisten en grandes cantidades de datos no se pueden enviar a través de la red como un flujo masivo de bits. Esto se debe a que otras personas necesitarán esperar a que se complete toda la comunicación antes de poder utilizar la red, y si la comunicación falla, el mensaje completo tendría que ser enviado de nuevo. En su lugar, los datos se dividen en una serie de piezas más pequeñas y se envían a través de la red. Esto se llama segmentación. La segmentación es requerida por el conjunto de protocolos TCP/IP. Los datos se envían como paquetes. Cada paquete se dirige por separado y puede tomar diferentes rutas a través de una red para llegar al destino. La segmentación aumenta la velocidad y la eficiencia de las redes de datos. Se gana una mayor velocidad porque muchas conversaciones de datos pueden tener lugar al mismo tiempo en la red. 

Este proceso se denomina multiplexación. La eficiencia se obtiene porque sólo se deben volver a enviar los datos que no son recibidos por un destino. Los mensajes se segmentan para ser enviados y deben recombinarse cuando se reciben. A medida que los datos se transmiten por la pila de protocolo que se va a enviar, cada capa agrega información diferente. Este proceso se llama encapsulamiento. La manera que adopta una porción de datos en cualquier capa se denomina unidad de datos del protocolo (Protocol Data Unit, PDU). Durante la encapsulación, las PDU se encapsulan dentro de las PDU en la siguiente capa de la pila cuando se envían los datos. El proceso inverso se produce cuando se reciben los datos. En la capa de aplicaciones OSI, la PDU generalmente se denomina simplemente datos. Los datos se encapsulan en segmentos o datagramas en la capa de transporte. La PDU de capa de red se denomina paquete, encapsula segmentos. La capa de vínculo de datos encapsula los datos en un marco. Finalmente, la capa física transmite bits a través de la red. 

Las capas de OSI de transporte, red y enlace de datos utilizan todas algún tipo de direccionamiento. 

La capa de transporte utiliza direcciones de protocolo en forma de números de puerto. La capa de red utiliza direcciones IP para identificar hosts y redes. Finalmente, la capa de vínculo de datos utiliza direcciones de hardware para identificar qué hosts de la red local deben manejar tramas. Estas direcciones identifican el origen de los datos y el destino de los datos. Después de recibir los datos, se desencapsulan para que los datos puedan ser utilizados por las aplicaciones cliente que los solicitaron.

# Protocolo de Internet y Ethernet

## Ethernet

Ethernet y LAN inalámbricas (WLAN) son las dos tecnologías LAN más populares. Ethernet opera en las capas físicas y de enlace de datos del modelo OSI y se definen en los estándares IEEE 802.2 y 802.3. Ethernet admite anchos de banda de 10 Mbps a 100.000 Mbps. Es importante conocer los campos de trama Ethernet. Una dirección MAC de Ethernet es un valor binario de 48 bits expresado como 12 dígitos hexadecimales (4 bits por dígito hexadecimal). La dirección MAC se puede representar mediante guiones, dos puntos o puntos entre los grupos de dígitos.

## IPv4

Los protocolos de capa de red permiten a los dispositivos finales intercambiar datos entre redes e Internet. IP versión 4 (IPv4) e IP versión 6 (IPv6) son los principales protocolos de comunicación de la capa de red. Para lograr comunicaciones punto a punto a través de los límites de la red, los protocolos de capa de red realizan cuatro operaciones básicas: El protocolo IP encapsula el segmento de la capa de transporte agregando un encabezado IP, que se utiliza para entregar el paquete al host de destino, el cuál es examinado por los dispositivos de la capa 3 (es decir, los Routers y Switches capa 3), para alcanzar el host de destino. El protocolo IP es connectionless (no reuqiere una ruta preestablecida), mejor esfuerzo e independiente de los medios. Es importante estar familiarizado con la estructura del paquete IP.

## Conceptos básicos del direccionamiento IP

La estructura de las direcciones IP consta de una dirección de red jerárquica de 32 bits que identifica la porción de red y la parte del host dentro de una red. Los bits dentro de la porción de red de la dirección deben ser idénticos para todos los dispositivos que residen en la misma red. Los bits dentro de la porción de host de la dirección deben ser únicos para identificar un host específico dentro de una red. A un host se le asigna una dirección IPv4 y una máscara de subred. La máscara de subred IPv4 se usa para diferenciar la porción de red de la porción de host de una dirección IPv4. La dirección de red representa todos los dispositivos de la misma red. La longitud del prefijo es el número de bits establecidos en 1 en la máscara de subred. Está escrito en "notación de barra", que se observa mediante una barra diagonal (/) seguida del número de bits establecidos en 1. El proceso real utilizado para identificar las porciones de red y host se llama ANDing. Las subredes crean dominios de difusión más pequeños para reducir el tráfico general de la red, mejorar el rendimiento de la red e implementar políticas de seguridad. Las subredes se pueden utilizar para agrupar dispositivos por ubicación, departamento o tipo de dispositivo.

## Tipos de direcciones IPv4

Las primeras implementaciones de IPv4 proporcionaron direcciones de red enrutables globalmente basadas en un sistema bajo un esquema de calase, que utiliza las Clases A, B y C, cada una de las cuales tiene diferentes rangos de direcciones IP. Sin embargo, el sistema de direccionamiento bajo este esquema era defectuoso y rápidamente agotó las direcciones de red disponibles y, por lo tanto, fue reemplazado por el actual sistema de direccionamiento sin esquemas de clases. Hay direcciones IPv4 públicas y direcciones IPv4 privadas. Las direcciones privadas deben ser utilizadas por las organizaciones y no se propagan en Internet. Hay tres bloques de direcciones privadas disponibles.

## La puerta de enlace (gateway) predeterminada

El dispositivo final de origen determina si un paquete está destinado a un host local o a un host remoto. En IPv4 -: El dispositivo de origen utiliza su propia máscara de subred junto con su propia dirección IPv4 y la dirección IPv4 de destino para realizar esta determinación. En IPv6: El router local anuncia la dirección de red local (prefijo) a todos los dispositivos de la red. El router conectado al segmento de red local se denomina gateway predeterminado. Tiene una dirección IP local en el mismo rango de direcciones que otros hosts en la red local. Puede aceptar datos en la red local y reenviar datos fuera de la red local. Este también enruta el tráfico a otras redes. Una ruta predeterminada es la ruta o camino que la PC utiliza cuando intenta conectarse a la red remota. En un host de Windows, el comando **route print** o **netstat -r** se puede usar para mostrar la tabla de enrutamiento del host.

## IPv6

Una dirección IPv6 es una dirección jerárquica de 128 bits. El espacio de direcciones de 128 bits proporciona un grupo mucho mayor de direcciones IP disponibles públicamente (340 undecilliones) que IPv4 (4,3 mil millones). El Protocolo de mensajes de control de Internet versión 6 (ICMPv6), también incluye la resolución y configuración automática de direcciones , Estas características no se encuentran presentes en ICMPv4. Las direcciones IPv6 se escriben como una cadena de valores hexadecimales. Cada cuatro bits está representado por un solo dígito hexadecimal; para un total de 32 valores hexadecimales. Hay dos reglas que ayudan a reducir el número de dígitos necesarios para representar una dirección IPv6. La primera regla es omitir los ceros iniciales en cualquier hexteto. 

Regla 2 : Los dos puntos dobles (::) pueden reemplazar cualquier cadena única y contigua de uno o más segmentos de 16 bits (hextetos) que estén compuestas sólo por ceros. La longitud del prefijo se representa en notación de barra diagonal y se usa para indicar la porción de red de una dirección IPv6. La longitud de prefijo puede ir de 0 a 128. La longitud de prefijo IPv6 recomendada para LAN y la mayoría de los otros tipos de redes es / 64. Esto se debe a que la autoconfiguración de direcciones sin estado (SLAAC) utiliza 64 bits para el ID de la interfaz. También facilita la creación y gestión de subredes.

# Verificacion de conectividad

## ICMP

El conjunto TCP/IP envía mensajes ICMP cuando los paquetes IP encuentran problemas de reenvío. Los mensajes de ICMP no son obligatorios y, a menudo, no se permiten dentro de una red por razones de seguridad. ICMPv4 es el protocolo de mensajes para IPv4, ICMPv6 proporciona estos mismos servicios para IPv6, pero incluye funcionalidad adicional. Los mensajes ICMP comunes a ICMPv4 e ICMPv6 son: Accesibilidad del host, Destino o Servicio inalcanzable, tiempo excedido y ruta de direccionamiento. ICMPv6 incluye los cuatro mensajes ICMPv6 adicionales para el Protocolo de detección de vecinos (NDP). Estos mensajes son mensajes de solicitud de router (RS) y anuncios de router(RA) que se envían entre enrutadores IPv6 y hosts IPv6, y mensajes de solicitud de vecino (NS) y anuncios de vecino (NA) que se envían entre dispositivos IPv6.

## Utilidades de Ping y Traceroute

Ping es una utilidad de prueba de IPv4 e IPv6 que utiliza la solicitud de eco ICMP y los mensajes de respuesta de eco para probar la conectividad entre los hosts. Algunos de los tipos de pruebas de conectividad que se realizan con ping incluyen hacer ping al bucle de retorno local, hacer ping a la puerta de enlace predeterminada y hacer ping a un host remoto. Traceroute (tracert) es una utilidad que genera una lista de saltos que se alcanzaron con éxito a lo largo de la ruta. Esta lista proporciona información importante sobre la verificación y la solución de problemas. Traceroute utiliza una función del campo TTL en IPv4 y del campo límite de saltos de IPv6 en los encabezados de capa 3, junto con el mensaje de Tiempo Excedido de ICMP. ICMP se encapsula directamente en paquetes IP como la carga útil de datos. La carga útil de datos ICMP contiene campos de datos de encabezado especiales.

# Protocolo de Resolución de Direcciones

## MAC e IP

Hay dos direcciones principales que se asignan a un dispositivo en una LAN Ethernet; la dirección IP, que se asigna lógicamente, y la dirección MAC que está asignada físicamente y es única para la interfaz de red. Las direcciones IP se utilizan para identificar la dirección del dispositivo de origen inicial y el dispositivo de destino final. La dirección IP de destino puede estar en la misma red IP que la de origen o en una red remota. Las direcciones de capa 2, o físicas, como las direcciones MAC Ethernet, tienen un propósito diferente: se utilizan para distribuir la trama de enlace de datos con el paquete IP encapsulado de una NIC a otra en la misma red. Si la dirección IP de destino está en la misma red, la dirección MAC de destino es la del dispositivo de destino.

## ARP

Cuando se utiliza IPv4 para las comunicaciones de red, se utiliza ARP para asignar la dirección IPv4 lógica con la dirección MAC de capa 2. Para crear una trama Ethernet, se debe conocer la dirección MAC de destino. Cuando la dirección IPv4 de destino está en la misma red que el origen, el proceso ARP envía la dirección IPv4 a todos los hosts de la red para que el host con la dirección IPv4 coincidente pueda responder con la dirección MAC correspondiente. El dispositivo de envío ahora tiene toda la información necesaria para construir la trama Ethernet de Capa 2. ARP proporciona dos funciones básicas: resolver direcciones IPv4 a direcciones MAC y mantener una tabla de asignaciones de direcciones IPv4 a MAC. El dispositivo emisor busca en su tabla ARP la dirección IPv4 de destino y la dirección MAC correspondiente. Si la dirección IPv4 de destino del paquete está en la misma red que la dirección IPv4 de origen, el dispositivo busca la dirección IPv4 de destino en la tabla ARP. Si no tiene una entrada para la dirección IPv4 en su tabla ARP, el dispositivo de envío envía una solicitud ARP para determinar la dirección MAC de destino. Sólo el dispositivo con la dirección IPv4 de destino asociada con la solicitud ARP responderá con una respuesta ARP. La respuesta ARP se encapsula en una trama Ethernet utilizando la siguiente información de encabezado: la dirección MAC de destino del host solicitante, la dirección MAC de origen del host que responde y el tipo, que es un código que identifica los datos pertenecientes al proceso ARP. Los mensajes ARP tienen un valor del campo de "tipo" de 0x806. Si la dirección IPv4 de destino está en una red diferente que la dirección IPv4 de origen, el dispositivo busca la dirección IPv4 del gateway predeterminado. IPv6 utiliza un proceso similar a ARP en IPv4. Se conoce como ICMPv6 Neighbor Discovery (ND). IPv6 utiliza mensajes de solicitud de vecino y de anuncio de vecino similares a las solicitudes y respuestas de ARP de IPv4.

## Problemas de ARP

Todos los dispositivos de la red local reciben y procesan una solicitud de ARP debido a que es una trama de difusión. En una red comercial típica, estas difusiones tendrían, probablemente, un efecto mínimo en el rendimiento de la red. Si se encendiera una gran cantidad de dispositivos que comenzaran a acceder a los servicios de red al mismo tiempo, el rendimiento podría disminuir durante un breve período de tiempo. Después de que los dispositivos envían las difusiones ARP iniciales y obtienen las direcciones MAC necesarias, se minimiza cualquier efecto en la red. Dado que la solicitud ARP es una transmisión o disfusión, hay posibles riesgos de seguridad impuestos. Un actor de amenaza puede usar la suplantación de ARP para realizar un ataque de envenenamiento de ARP respondiendo a una solicitud ARP para una dirección IPv4 que pertenece a otro dispositivo, como la puerta de enlace predeterminada. El receptor de la respuesta de ARP agrega la dirección MAC incorrecta a la tabla ARP y envía estos paquetes al atacante.

# Capa de Transporte

## Características de la Capa de Transporte

La capa de transporte es el enlace entre la capa de aplicación y las capas inferiores que son responsables de la transmisión a través de la red. La capa de transporte es responsable de las comunicaciones lógicas entre aplicaciones que se ejecutan en diferentes hosts. La capa de transporte incluye los protocolos TCP y UDP. Los protocolos de capa de transporte especifican cómo transferir mensajes entre hosts y es responsable de administrar los requisitos de fiabilidad de una conversación. La capa de transporte es responsable del seguimiento de conversaciones (sesiones), la segmentación de datos y el reensamblaje de segmentos, la adición de información de encabezado, la identificación de aplicaciones y la multiplexación de conversaciones. TCP es de estado y confiable. Reconoce datos, reenvía la pérdida de datos y ofrece los datos en orden de secuencia. Utilice TCP para el correo electrónico y la web. UDP es sin estado y rápida. Rápido, de baja sobrecarga, no requiere confirmaciones, no vuelve a enviar la pérdida de datos y ofrece datos como llegan. Use UDP para VoIP y DNS.

Los protocolos de capa de transporte TCP y UDP utilizan números de puerto para administrar múltiples conversaciones simultáneas. Esta es la razón por la que los campos de encabezado TCP y UDP identifican un número de puerto de aplicación de origen y destino. Los puertos de origen y de destino se colocan dentro del segmento. Los segmentos se encapsulan dentro de un paquete IP. Se conoce como socket a la combinación de la dirección IP de origen y el número de puerto de origen, o de la dirección IP de destino y el número de puerto de destino. El socket se utiliza para identificar el servidor y el servicio solicitado por el cliente y el host y la aplicación en el host que deben manejar los datos devueltos. Hay un rango de números de puerto entre 0 y 65535.

## Establecimiento de la Sesión de Capa de Transporte

El protocolo de enlace de tres capas establece que el dispositivo de destino está presente en la red. Verifica que el dispositivo de destino tenga un servicio activo y acepte solicitudes en el número de puerto de destino que el cliente de origen desea utilizar. Informa al dispositivo de destino que el cliente de origen intenta establecer una sesión de comunicación en dicho número de puerto Los seis indicadores de bits de control son: URG, ACK, PSH, RST, SYN y FIN y se utilizan para identificar la función de los mensajes TCP que se envían. Un cliente o servidor puede terminar una sola conversación compatible con TCP enviando una secuencia de mensajes TCP.

## Confiabilidad de la Capa de Transporte

Para que el receptor comprenda el mensaje original, los datos en estos segmentos se vuelven a ensamblar en el orden original. Se asignan números de secuencia en el encabezado de cada paquete. No importa cuán bien diseñada esté una red, ocasionalmente se produce la pérdida de datos. TCP proporciona formas de administrar pérdidas de segmentos. Hay un mecanismo para retransmitir segmentos para datos no reconocidos. Los sistemas operativos host actualmente suelen emplear una característica TCP opcional llamada reconocimiento selectivo (SACK), negociada durante el protocolo de enlace de tres vías. Si ambos hosts admiten SACK, el receptor puede reconocer explícitamente qué segmentos (bytes) se recibieron, incluidos los segmentos discontinuos. Por lo tanto, el host emisor solo necesitaría retransmitir los datos faltantes. El control de flujo permite mantener la confiabilidad de la transmisión de TCP mediante el ajuste de la velocidad del flujo de datos entre el origen y el destino. Para lograr esto, el encabezado TCP incluye un campo de 16 bits llamado “tamaño de la ventana”. El proceso en el que el destino envía reconocimientos a medida que procesa los bytes recibidos y el ajuste continuo de la ventana de envío del origen se conoce como ventanas deslizantes. El origen está transmitiendo 1460 bytes de datos dentro de cada segmento TCP. Normalmente, es el tamaño máximo de segmento (MSS) que puede recibir el dispositivo de destino. Para evitar y controlar la congestión, TCP emplea varios mecanismos de manejo de congestión.

# Servicios de Red

## DHCP

El Protocolo de Configuración de Host Dinámico (Dynamic Host Configuration Protocol) (DHCP) automatiza la asignación de direcciones IPv4. Esto se conoce como la alternativa al direccionamiento estático y es el direccionamiento dinámico. En redes más grandes, o donde la población de usuarios cambia con frecuencia, el direccionamiento dinámico es a menudo el método preferido para la asignación de direcciones. Muchas redes utilizan ambos métodos. DHCP se utiliza para hosts de propósito general, como dispositivos finales de usuario. El direccionamiento estático se utiliza para los dispositivos de red, tales como (puertas de enlace )gateways, switches, servidores e impresoras.

Cuando un dispositivo configurado con IPv4 DHCP se inicia o se conecta a la red, el cliente transmite un mensaje de descubrimiento de DHCP (DHCPDISCOVER) para identificar cualquier servidor DCHP que esté disponible en la red. Un servidor DHCP responde con un mensaje de oferta DCHP (DHCPOFFER), que ofrece una concesión al cliente. El mensaje de oferta contiene la dirección IPv4 y la máscara de subred que se deben asignar, la dirección IPv4 del servidor DNS y la dirección IPv4 del gateway predeterminado. El cliente puede recibir varios mensajes de OFERTA DHCP si hay más de un servidor DHCP en la red local. Debe elegir entre ellos y envía un mensaje DCHPREQUEST que identifica el servidor explícito y la oferta de arrendamiento que el cliente está aceptando. Si la dirección IPv4 aún está disponible, el servidor devuelve un mensaje DHCPACK. Si la oferta ya no es válida, devolverá un mensaje DCHPNACK. El formato del mensaje DHCPv4 se utiliza para todas las transacciones DHCPv4. Los mensajes DHCPv4 se encapsulan dentro del protocolo de transporte UDP.

## Descripción general de DNS

El sistema de nombres de dominio (DNS) se desarrolló para proporcionar un medio confiable de administrar y proporcionar los nombres de dominio y sus direcciones IP asociadas. El sistema de DNS se compone de una jerarquía global de servidores distribuidos que contienen bases de datos con asignaciones de nombre para las direcciones IP. Los analistas de ciberseguridad deben tener un conocimiento profundo del DNS porque un análisis reciente de las amenazas a la seguridad de la red descubrió que más del 90% del software malicioso que se usa para atacar las redes usa el sistema DNS para llevar a cabo campañas de ataque.

Los siguientes son los pasos involucrados en la resolución de DNS:

- El usuario escribe un FQDN en un campo de dirección del navegador.
- Se envía una consulta de DNS al servidor DNS designado.
- El servidor DNS hace coincidir el FQDN con su dirección IP.
- La respuesta de la consulta de DNS se envía de vuelta al cliente con la dirección IP para el FDQN.
- El equipo cliente utiliza la dirección IP para enviar solicitudes al servidor.

DNS utiliza el puerto UDP 53 para las consultas y respuestas de DNS. El servidor DNS almacena los diferentes tipos de RR utilizados para resolver nombres. Estos registros contienen el nombre, la dirección y el tipo de registro. Este formato de mensaje que se ve en la figura se utiliza para todos los tipos de solicitudes de clientes y respuestas del servidor, para los mensajes de error y para la transferencia de información de registro de recursos entre servidores. DNS dinámico (DDNS) le permite a un usuario u organización registrar una dirección IP con un nombre de dominio, al igual que en DNS. Sin embargo, cuando la dirección IP del mapeo cambia, el nuevo mapeo se puede propagar por todo el DNS casi instantáneamente. Los agentes de amenazas pueden abusar de DDNS de varias maneras y las URL que usan DDNS deben ser sospechosas. WHOIS es un protocolo basado en TCP que se utiliza para identificar a los propietarios de dominios de Internet a través del sistema DNS. WHOIS tiene limitaciones y los hackers tienen maneras de ocultar su identidad.

## NAT

NAT proporciona la traducción de direcciones privadas a direcciones públicas. Esto permite que los dispositivos con direcciones IPv4 privadas accedan a recursos fuera de su red privada, como los que se encuentran en Internet. NAT ayuda a conservar las direcciones IPv4 públicas. Los routers con NAT habilitada se pueden configurar con una o más direcciones IPv4 públicas válidas. Estas direcciones se conocen como grupo NAT. En general, los routers NAT funcionan en la frontera de una red de rutas internas. Cuando un dispositivo dentro de la red de rutas internas desea comunicarse con un dispositivo fuera de su red, el paquete se reenvía al router de frontera. El enrutador de borde realiza el proceso NAT, traduciendo la dirección privada interna del dispositivo a la dirección pública, externa y enrutable. La traducción de la dirección del puerto (PAT), también conocida como “NAT con overload”, asigna varias direcciones IPv4 privadas a una única dirección IPv4 pública o algunas direcciones.

## Servicios de transferencia de archivos y uso compartido

El Protocolo de transferencia de archivos (FTP) es otro protocolo de capa de aplicación de uso común. Fue desarrollado para permitir transferencias de archivos entre un cliente y un servidor. Para transferir archivos correctamente, FTP requiere dos conexiones entre el cliente y el servidor: una para comandos y respuestas, y otra para la transferencia de archivos real. El protocolo de transferencia de archivos SSH es una forma segura de FTP que utiliza Secure Shell para proporcionar un canal seguro. El Protocolo de transferencia de archivos trivial (TFTP) es un protocolo de transferencia de archivos simplificado que utiliza el puerto UDP número 69. TFTP es fundamentalmente inseguro. El bloque de mensajes del servidor (SMB) es un protocolo de intercambio de archivos cliente / servidor que describe la estructura de los recursos de red compartidos, como directorios, archivos, impresoras y puertos serie. Los servicios de impresión y el uso compartido de archivos se han convertido en el pilar de las redes de Microsoft.

## Correo electrónico

Los clientes de correo electrónico se comunican con servidores de correo para enviar y recibir correo electrónico. Los servidores de correo se comunican con otros servidores de correo para transportar mensajes de un dominio a otro. El correo electrónico soporta tres protocolos separados para funcionar: SMTP, POP e IMAP. El proceso de la capa de aplicación que envía correo desde un cliente a un servidor de correo electrónico utiliza SMTP. Un cliente recupera el correo electrónico de un servidor de correo mediante POP3 o IMAP.

## HTTP

Los navegadores web y los servidores web interactúan mediante los siguientes pasos:

1. El navegador interpreta las tres partes de la URL.
2. El navegador comprueba con un servidor de nombres para convertir una dirección en una dirección IP numérica. El cliente inicia una solicitud HTTP a un servidor enviando una solicitud GET al servidor.
3. En respuesta a la solicitud, el servidor envía el HTML de esta página web al navegador.
4. El navegador descifra el HTML y muestra la página para la ventana del navegador.

HTTP URLS también puede especificar el puerto en el servidor que debe manejar los métodos HTTP. 

Además, puede especificar una cadena y un fragmento de la consulta. HTTP es un protocolo de solicitud y respuesta que utiliza el puerto TCP 80, aunque se pueden utilizar otros puertos. Cuando un cliente envía una solicitud a un servidor web, utiliza uno de los seis métodos especifcados en el protocolo HTTP: GET, POST, PUT, DELETE, OPTIONS y CONNECT. HTTP es flexible pero no seguro. Las respuestas del servidor HTTP se identifican con códigos de estado organizados en cinco grupos de códigos: 1xx, 2xx, 3xx, 4xx y 5xx. HTTP/2 es una revisión importante de la especificación del protocolo HTTP que está diseñada para mejorar el rendimiento HTTP solucionando problemas de latencia. Para una comunicación segura a través de Internet, se utiliza HTTP seguro (HTTPS). HTTPS usa la autenticación y encriptación para asegurar los datos mientras viajan entre el cliente y el servidor.

# Dispositivos de comunicación por redes

## Dispositivos de red

En este módulo, aprendió que los dispositivos finales que están conectados a una LAN se conectan a otras LAN mediante una interred de dispositivos intermediarios, como routers y switches.

Los routers son dispositivos de la capa de red (Capa 3) y utilizan el proceso de enrutamiento para reenviar paquetes de datos entre redes o subredes. Los routeres proporcionan:

- Determinación de ruta: el router crea una tabla de enrutamiento que contiene una lista de todas las rutas de red remotas y conectadas directamente conocidas y cómo llegar a ellas. La información de la tabla de enrutamiento se configura manualmente mediante rutas estáticas o se descubre dinámicamente mediante un protocolo de enrutamiento dinámico (por ejemplo, RIP, OSPF, EIGRP, BGP). El procesamiento de la decisión de reenvío de paquetes se basa en la coincidencia más larga y determina cómo encapsular el paquete y reenviarlo a la interfaz de salida correcta.
- Servicios de reenvío de paquetes: los paquetes entrantes pasan por el proceso de determinación de rutas para identificar la interfaz saliente. El router luego proporciona la función de switching encapsulando los paquetes de salida en el tipo de enlace de datos apropiado y lo reenvía a la interfaz de salida.

Los switches segmentan una red LAN en dominios de colisión separados, uno para cada puerto del switch. Un switch toma decisiones de reenvío basado en la tabla de direcciones MAC de Ethernet, que están contenidos en el segmento de Ethernet. El switch utiliza la dirección de origen de trama para obtener información sobre las nuevas direcciones MAC y la dirección MAC de destino para identificar el puerto de salida para reenviar la trama. Los switches admiten la creación de VLAN (es decir, dominios de difusión lógica) para mejorar el rendimiento y la seguridad de la red. Para la redundancia, los switches suelen estar interconectados para proporcionar rutas alternativas que pueden causar problemas de bucle de capa 2. Los switches se configuran con el protocolo de árbol de expansión (STP) para mantener una ruta de capa 2 libre de bucle bloqueando intencionalmente las rutas redundantes que podrían provocar un bucle.

Los switches multicapa (también conocidos como switches de Capa 3) no solo tiene a su cargo el switching de Capa 2 sino que también reenvían tramas en función de la información de las capas 3 y 4. Un switch multicapa Cisco Catalyst soporta puertos enrutados e interfaces virtuales de switch (SVIs).

## Comunicaciones inalámbricas

Los dispositivos de red inalámbrica se conectan a un punto de acceso (AP) o a un controlador de LAN inalámbrica (WLC) que demandan el estándar 802.11. El formato de la trama 802.11 es similar al formato de trama de Ethernet, excepto que este contiene campos adicionales. Los dispositivos WLAN usan CSMA/CA como método para determinar cómo y cuándo enviar datos en la red Para conectarse a la WLAN, los dispositivos inalámbricos completan un proceso de tres etapas para descubrir un punto de acceso inalámbrico, autenticarse con el punto de acceso y asociarse con el punto de acceso (AP)

Los AP se pueden configurar de forma autónoma (individualmente) o mediante un WLC para simplificar la configuración y supervisión de numerosos puntos de acceso.

# Infraestructura de seguridad de Red

## Topologías de red

En este capítulo, aprendió el funcionamiento básico de la infraestructura de la red. Las infraestructuras de red varían mucho según el tamaño del área de cobertura, el número de usuarios conectados, el número y los tipos de servicios disponibles y el área de responsabilidad. Las redes son normalmente representadas como topologías lógicas y físicas. Una topología física representa las conexiones físicas y cómo están conectados los dispositivos finales. Una topología lógica se refiere a los estándares y protocolos que utilizan los dispositivos para comunicarse. La mayoría de los diagramas de topologías son una combinación de ambas topologías y permiten ver cómo se conectan los dispositivos a nivel físico y lógico. Los dos tipos más comunes de infraestructuras de red son LAN y WAN. El diseño de LAN cableada del campus consta de capas jerárquicas con funciones específicas asignadas a cada capa. La capa de acceso proporciona acceso directo a la red para puntos finales. La capa de distribución agrega capas de acceso y brinda conectividad a los servicios. Por último, la capa de núcleo proporciona conectividad entre las capas de distribución en grandes ambientes. En algunos casos, las capas de distribución y núcleo se pueden combinar para reducir el costo y la complejidad.

Las arquitecturas de seguridad comunes definen los límites del tráfico que entra y sale de la red. Si echamos un vistazo a una topología que tiene acceso a redes externas o públicas, debemos ser capaces de determinar la arquitectura de seguridad. Algunos diseños son tan simples y solo consisten en diseñar una red externa y una interna, que son determinadas por dos interfaces en un firewall. Las redes que requieren acceso público a servicios a menudo tienen una DMZ a la que puede acceder el público, mientras que bloquean estrictamente el acceso a la red interna. Los ZPF emplean el concepto de las zonas para brindar más flexibilidad. Una zona es un grupo de una o más interfaces que tienen funciones similares, características y requerimientos de seguridad.

## Dispositivos de seguridad

Hay varios tipos diferentes de firewalls. ﻿Los firewalls de filtrado de paquetes (sin estado) proporcionan filtrado de Capa 3 y, a veces, de Capa 4. Una inspección de estado de firewall permite o bloquea el tráfico basado en estado, puerto, y protocolo. Firewall de gateway de aplicación (firewall proxy) filtra la información de capa 3, 4, 5 y 7. Los firewalls de última generación proporcionan servicios adicionales más allá de las puertas de enlace de aplicaciones, como la prevención integrada de intrusiones, el reconocimiento y el control de las aplicaciones para ver y bloquear aplicaciones arriesgadas, el acceso a fuentes de información futuras y las técnicas para hacer frente a las amenazas de seguridad en evolución. Los sistemas de prevención de intrusiones (Intrusion prevention system IPS) y los sistemas de detección de intrusiones (IDS) se utilizan para detectar posibles riesgos de seguridad y alertar o detener el tráfico no seguro. IDS/IPS se puede implementar como basado en host o en red con ventajas y desventajas específicas para cada implementación. 

Están disponibles dispositivos de seguridad especializados, incluidos Proteccin avanzada de malware de Cisco (Cisco Advanced Malware Protection AMP), Cisco Web Security Appliance (WSA) y Cisco Email Security Appliance (WSA). Estos dispositivos de seguridad utilizan los servicios de Cisco Talos Security Intelligence and Research Group. Talos detecta y correlaciona amenazas en tiempo real por medio de la mayor red de detección de amenazas del mundo.

## Servicios de seguridad

Los servicios de seguridad de red incluyen las siguientes tecnologías. Las ACL son una serie de declaraciones que controlan si un dispositivo reenvía o descarta paquetes según la información que se encuentra en el encabezado del paquete. Permite que los administradores de redes monitoreen y administren el rendimiento de la red, detecten y resuelvan problemas de red y planifiquen el crecimiento de la red. NetFlow provee estadísticas sobre los paquetes que pasan a través de un router Cisco o un switch multicapa. La replicación de puertos es una característica que le permite al switch hacer copias del tráfico que pasa y, luego, enviarlas a un puerto con un supervisor de redes conectado. Los servidores Syslog compilan y proporcionan acceso al sistema de mensajes generado por los dispositivos de red. NTP sincroniza el sistema de tiempo en todos los dispositivos en la red para asegurar que guarden las marcas de tiempo del sistema de mensajes. AAA es un marco de trabajo para configurar los servicios de autenticación, autorización y auditoría del usuario. Por lo general, AAA utiliza un servidor TACACS+ o RADIUS para este propósito. Las VPN son redes privadas que son creadas entre dos puntos finales a través de una red pública.

# Atacantes  y sus Herramientas

## ¿Quién ataca nuestra red?

Para comprender la seguridad de la red es necesario comprender los siguientes términos: amenaza, vulnerabilidad, superficie de ataque, exploit y riesgo. La gestión de riesgos es el proceso que equilibra los costos operacionales de proporcionar medidas de protección con los beneficios que brinda la protección de los activos. Cuatro formas comunes de gestionar el riesgo son la aceptación de riesgos, evitar los riesgos, la reducción de riesgos y la transferencia de riesgos. El término hacker es utilizado para describir a un atacante. Los hackers de sombrero blanco son hackers éticos que utilizan sus habilidades de programación con fines buenos, morales y legales. Los hackers de sombrero gris son personas que cometen delitos y realizan acciones probablemente inmorales, pero no para beneficio personal ni para causar daños. Los hackers de sombrero negro son delincuentes inmorales que violan la seguridad de una computadora y una red para beneficio personal o por motivos maliciosos, como ataques a la red. Algunos términos para describirlos son script kiddies, vulnerability brokers, hacktivistas, ciberdelincuentes y hackers patrocinados por el Estado. Muchos ataques de red pueden ser prevenidos si se comparte la información acerca de los Indicadores de Peligro (IOC). En la actualidad, muchos gobiernos están promoviendo activamente la ciberseguridad. La CISA y la NCSA son algunos ejemplos de esas organizaciones.

## Introducción a las herramientas de ataque

Los atacantes utilizan una técnica o herramienta. Las herramientas de ataque se han vueltos más sofisticadas y altamente automatizadas. Muchas de las herramientas están basadas en Linux o UNIX y su conocimiento es útil para un profesional de la ciberseguridad. Existen varios tipos de herramientas de seguridad y de hacking, como descifradores de contraseñas, herramientas de hacking inalámbrico, herramientas de escaneo de seguridad y de hacking de redes, herramientas de creación de paquetes, rastreadores de paquetes, detectores de rootkits, fuzzers para buscar vulnerabilidades, herramientas forenses, depuradores, sistemas operativos de hacking, herramientas de encriptación, herramientas de ataque a vulnerabilidades y escáneres de vulnerabilidades. Las categorías de ataques incluyen los ataques de intercepción pasiva, los ataques de modificación de datos, los ataques de suplantación de dirección IP, los ataques basados en contraseñas, los ataques de denegación de servicio, los ataques de intermediarios (MiTM), los ataques de claves comprometidas y los ataques tipo sniffer.

# Amenazas y ataques comunes

## Malware

Malware es la abreviatura de software malicioso o código malicioso. Los atacantes frecuentemente intentan engañar a los usuarios para que instalen malware para ayudar a explotar las vulnerabilidades de los terminales. A menudo, el software antimalware no se puede actualizar lo suficientemente rápido para detener nuevas amenazas. Los tres tipos más comunes de malware son los virus, los gusanos informáticos y los troyanos. Un virus es un tipo de malware que se propaga al introducir una copia de si mismo dentro de otro programa. La mayoría de los virus se propagan mediante memorias USB, CD, DVD, recursos compartidos en la red o mediante correo electrónico. 

Un troyano es un software que parece ser legítimo, pero que contiene código malicioso que aprovecha los privilegios del usuario que lo ejecuta. A menudo, los troyanos se encuentran en los juegos en línea. Los caballos de Troya suelen clasificarse según el daño que causan. Algunos tipos de troyanos son: de acceso remoto, envíos de datos, destructivos, proxy, FTP, desactivadores de software de seguridad, DoS y registradores de teclas. Los gusanos informáticos son similares a los virus, porque se replican y pueden causar el mismo tipo de daño. Los virus requieren de un programa host para ejecutarse. Los gusanos pueden ejecutarse por sí mismos. La mayoría de los gusanos se componen de tres componentes: activación de vulnerabilidad, mecanismo de propagación y carga dañina (payload). Actualmente, el malware dominante es el ransomware. 

Deniega el acceso al sistema informático infectado o a sus datos. Después de atacar, los ciberdelincuentes exigen dinero para liberar el sistema informático. Otros ejemplos de malware son spyware, adware, scareware, phishing, y rootkits.

## Ataques de red comunes: Reconocimiento, Acceso, e Ingeniería Social

Los atacantes también pueden atacar la red desde el exterior. Para mitigar los ataques, es útil clasificar los diferentes tipos de ataques. Las tres categorías principales son los ataques de Reconocimiento, Acceso y DoS. El reconocimiento es recopilación de información. Los atacantes realizan detecciones y mapeos no aut﻿orizados de sistemas, servicios o vulnerabilidades. Los ataques de reconocimiento preceden a los ataques de acceso o a los ataques DoS. Algunas de las técnicas utilizadas son las siguientes: Consulta de información sobre el objetivo (en páginas como Google y Whois), barrido de ping en la red objetivo, escaneo de puertos en busca de direcciones IP activas, o la ejecución de escáneres de vulnerabilidades o herramientas de ataque. Los ataques de acceso aprovechan vulnerabilidades conocidas en servicios de autenticación, servicios FTP y servicios web. 

Estos ataques incluyen ataques de contraseña, ataques de suplantación de identidad, ataques de confianzas, redireccionamiento de puertos, ataques Man-in-the-middle, y ataques de desbordamiento de búfer. La Ingeniería social es un ataque de acceso que intenta manipular a las personas, para que realicen acciones inseguras o divulguen información confidencial. Algunos de estos ataques son: pretexting (pretextos elaborados), Phishing, "algo por algo", baiting, suplantación de identidad (impersonation) tailgating, shoulder surfing, y hurgamiento de basura.

## Ataques de red: Denegación de Servicios, Desbordamientos de búfer, y Evasión

Un ataque de DoS da como resultado la interrupción de servicios de red a los usuarios, dispositivos o aplicaciones. Hay dos tipos principales: sobrecarga de tráfico y paquetes maliciosos formateados. 

Los ataques de DDoS son similares en objetivo a los ataques de DoS, salvo que un ataque de DDoS tiene mayor magnitud, ya que se origina a partir de varias fuentes coordinadas. Los siguientes términos se utilizan para describir los ataques DDoS: zombis, bots, botnet, handlers, y botmaster. 

Mirai es un malware que se dirige a los dispositivos IoT configurados con información de inicio de sesión predeterminada. Mirai usa un "ataque de diccionario" de fuerza bruta. Después de un acceso exitoso, Mirai se dirige a las utilidades BusyBox basadas en Linux que están diseñadas para estos dispositivos. El objetivo de un atacante cuando utiliza un ataque DoS de desbordamiento de búfer es encontrar una falla de sistema relacionada con la memoria en un servidor y aprovecharla. 

Sobrecargar la memoria intermedia con valores imprevistos suele interrumpir el funcionamiento del sistema, creando un ataque DoS. Muchos de los ataques utilizan técnicas de evasión sigilosas para disfrazar una carga dañina (payload). Algunos métodos de evasión son la encriptación y tunelling, el agotamiento de recursos, la fragmentación de tráfico, la interpretación malinterpretación a nivel de protocolo, la sustitución de tráfico, la inserción de tráfico, pivoting, rootkits y proxys.

# Monitoreo de red y sus herramientas

## Topología de seguridad de la red

Para mitigar las amenazas, todas las redes deben estar aseguradas y protegidas mediante un enfoque de defensa en profundidad. La red requiere una infraestructura de seguridad constituida de firewalls, Sistema de Detección de Intrusiones (IDS, siglas en inglés), Sistema de Prevención de Intrusiones (IPS, siglas en inglés), y software de seguridad de punto terminal (endpoint security). 

Para redes grandes, debe de añadirse una capa adicional de protección. Un analista de ciberseguridad debe revisar todas las alertas generadas por los dispositivos de red y validarlas. Para determinar el comportamiento normal de una red, el monitoreo de red debe de ser implementado. 

Algunas herramientas empleadas para evaluar el comportamiento son los IDS, los analizadores de paquetes, SNMP, NetFlow, y otras. Dos métodos comunes que se utilizan para capturar tráfico y enviarlo a dispositivos de monitoreo de red son los taps de red (TAP) y la duplicación de tráfico mediante Switched Port Analyzer (SPAN) u otra duplicación de puertos. Un tap de red suele ser un dispositivo de división pasiva implementado en el cableado de la red, entre un dispositivo de interés y la red. Un tap reenvía todo el tráfico, incluidos los errores de capa física, a un dispositivo de análisis, al mismo tiempo que permite que el tráfico llegue a su destino previsto. Los switches de red segmentan el diseño de la red. Esto limita la cantidad de tráfico visible para los dispositivos de monitoreo de red. Debido a esto, la captura de datos para el monitoreo de red requiere que todo el tráfico evite la segmentación de la red, provocada por los switches. La duplicación de puertos es una técnica que permite esto. Los siguientes términos forman parte de la terminología de la función SPAN: tráfico de entrada, tráfico de salida, puerto de origen SPAN y puerto de destino SPAN.

## Introducción a las herramientas de monitoreo de red

Las herramientas comunes que se utilizan para el monitoreo de seguridad de red son: analizadores de protocolos de red (Wireshark y Tcpdump), NetFlow y SIEM. Es común que los analistas de seguridad confíen en los archivos de registro y en el Protocolo Simple de Administración de Red (SNMP, siglas en inglés) para detectar el comportamiento normal de la red. Los analizadores de protocolo de red (o “packet sniffers”) son programas utilizados para capturar el tráfico. Los packet sniffers muestran lo que está sucediendo en la red, frecuentemente a través de una interfaz gráfica de usuario. Los analistas pueden utilizar estas aplicaciones para ver intercambios de red hasta el nivel de paquetes. NetFlow es una tecnología de Cisco IOS que proporciona estadísticas 24/7 sobre los paquetes que atraviesan un router o switch multicapa de Cisco. Puede utilizarse para el monitoreo de red y de seguridad, el análisis de tráfico, y la planificación de redes. SIEM es una tecnología que ofrece informes en tiempo real y análisis a largo plazo sobre eventos de seguridad. SIEM incluye análisis forense y funciones de correlación, acumulación y reportes. Existen varios sistemas SIEM, incluidos SolarWinds Security Manager y Splunk Enterprise Security. Los sistemas Security Orchestration, Automation, and Response (SOAR) proporcionan mejoras a SIEM.

# Ataque a los Fundamentos

IP fue diseñado como un protocolo sin conexión de capa 3. El encabezado IPv4 consta de varios campos, mientras que el encabezado IPv6 contiene menos campos. Es importante que los analistas de seguridad entiendan los diferentes campos de los encabezados de IPv4 e IPv6.

## Vulnerabilidades IP

Existen distintos tipos de ataques de IP. Los ataques comunes relacionados con IP incluyen:

- Ataques de ICMP
- Ataques de Denegación de Servicios (DoS, siglas en inglés)
- Ataques de Denegación de Servicios Distribuida (DDoS, siglas en inglés)
- Ataques de suplantación de dirección.
- Ataques Man-in-the-middle (MiTM)
- Secuestros de sesiones

El ICMP se desarrolló para llevar mensajes de diagnóstico e informar condiciones de error cuando no están disponibles rutas, hosts y puertos. Los atacantes utilizan el ICMP para los ataques de reconocimiento y análisis. Los atacantes también utilizan ICMP para ataques DoS y DDoS Los atacantes suelen usar técnicas de amplificación y reflexión para crear ataques DoS. Los atacantes también utilizan ataques de agotamiento de recursos para consumir los recursos de un host objetivo, con el propósito de que deje de funcionar o para consumir los recursos de una red. Los ataques de Suplantación de dirección IP se producen cuando un atacante crea paquetes con información suplantada (o falsa) de la dirección IP de origen para ocultar la identidad del remitente o hacerse pasar por otro usuario legítimo. Los ataques de suplantación de dirección pueden ser una spoofing non-blind (a ciegas) para secuestrar una sesión o una spoofing blind (con visibilidad) para crear un ataque DoS. Los ataques de suplantación (spoofing) de dirección MAC se utilizan cuando los atacantes tienen acceso a la red interna.

## Vulnerabilidades de TCP y UDP

La información de segmento TCP y del datagrama UDP, aparece inmediatamente después del encabezado de IP. Es importante comprender los encabezados de Capa 4 y sus funciones en la comunicación de datos. TCP proporciona entrega confiable, control de flujo y comunicación con estado. La comunicación TCP con estado entre 2 partes ocurre durante la comunicación de "intercambio de señales de tres vías" de TCP (three-way handshake). Los atacantes pueden llevar a cabo una variedad de ataques relacionados con TCP:

- Escaneo (análisis) de puertos TCP
- Ataque de saturación TCP SYN
- Ataque de restablecimiento TCP
- Ataque de secuestro de sesión TCP

El segmento UDP (es decir, datagrama) es mucho más pequeño que el segmento TCP, lo que hace que sea muy conveniente para su uso por protocolos que hacen transacciones simples de solicitud y respuesta como DNS, DHCP y SNMP. Los atacantes pueden llevar a cabo ataques de saturación UDP que analizan todos los puertos UDP conocidos en un servidor, intentando encontrar puertos cerrados. Esto puede crear una situación de DoS.

# Atacando lo que hacemos

## Servicios IP

Los hosts transmiten una solicitud de ARP hacia otros hosts del segmento, para determinar la dirección MAC de un host con una dirección IP específica. Cualquier cliente puede enviar una respuesta de ARP no solicitada llamada "ARP gratuito." Está característica de ARP también significa que cualquier host puede decir ser el dueño de cualquier dirección IP/MAC que escoja. Un atacante puede envenenar la caché ARP de los dispositivos en la red local y crear un ataque MiTM para redireccionar el tráfico.

El protocolo DNS define un servicio automatizado que empareja los nombres de recursos, como [www.cisco.com](http://www.cisco.com/), con su respectiva dirección IP. Incluye el formato de mensaje de consultas, respuestas y datos. Utiliza Registros de recursos (RR) para identificar el tipo de respuesta DNS. DNS es fundamental para la operación y funcionamiento de una red y debe ser protegido correctamente. 

Muchas empresas utilizan los servicios públicos de servidores de resolución DNS abierta (open resolvers) para responder las consultas. Los servidores de DNS abiertos son vulnerables a varias actividades maliciosas, incluido el envenenamiento de caché DNS, en el que se proporcionan registros falsificados al servidor abierto. En los ataques de amplificación y reflexión DNS, se aprovecha la naturaleza benigna del protocolo DNS, para causar ataques DoS o DDoS. En los ataques de utilización de recursos DNS, se inicia un ataque DoS contra el propio servidor DNS. Los atacantes suelen ocultarse utilizando técnicas sigilosas, como Fast Flux, una técnica en la cual los servidores maliciosos cambian rápidamente su dirección IP. Los atacantes también utilizan Double IP Flux para cambiar rápidamente su nombre de dominio para las asignaciones de dirección IP y también cambiar el servidor de nombres autorizados. Los atacantes también podrían utilizar "Domain shadowing" para ocultar el origen de sus ataques mediante la recolección de credenciales de cuenta de dominio, para crear múltiples subdominios para utilizarlos durante los ataques.﻿ A veces, el DNS en la empresa no se tiene en cuenta como un protocolo que las botnets pueden utilizar. Los atacantes que utilizan la tunelización DNS colocan tráfico que no es de DNS en tráfico DNS. Con frecuencia, este método evita las soluciones de seguridad. Para poder detener la tunelización DNS, debe utilizarse un filtro que inspeccione el tráfico de DNS. Los servidores DNS dinámicos son populares entre los atacantes y el tráfico que utiliza DNS Dinámico debería ser una preocupación especial para el analista de ciberseguridad.

DHCP utiliza un intercambio simple de mensajes de broadcast y unicast para proporcionar a los hosts información de direccionamiento. Un ataque de suplantación DHCP se produce cuando un servidor DHCP malicioso se conecta a la red, y proporciona parámetros falsos de configuración IP a los clientes legítimos. El servidor malicioso puede proporcionar información incorrecta sobre la puerta de enlace por defecto, el servidor DNS o direcciones IP.

## Servicios empresariales

Los navegadores web son utilizados por casi todos a nivel mundial. Bloquear por completo la navegación web no es una opción, ya que las empresas necesitan tener acceso a la web. Los analistas de ciberseguridad deben tener una buena comprensión sobre cómo funciona un ataque estándar basado en web. Las fases comunes de un ataque típico web incluyen que la victima (sin saberlo) acceda a una página web que ha sido comprometida con malware. La página web comprometida redirige al usuario a un sitio que aloja código malicioso. El navegador visita este sitio y el código malicioso infecta su computadora. Esto se conoce como "drive-by download". Independientemente del tipo de ataque que se utilice, el objetivo principal del atacante es asegurarse que el navegador web de la víctima llegue a su página web, la cual introduce el código malicioso en la computadora de la víctima. Algunos sitios maliciosos toman ventaja de los complementos (plugins) vulnerables o de las vulnerabilidades del navegador para comprometer el sistema del cliente. Las redes más grandes dependen de los IDS para analizar los archivos descargados, en busca de malware. Si detectan que los archivos podrían contener malware, los IDS emiten alertas y registran el evento en archivos de registro (log files) para su posterior análisis. Los registros de conexión del servidor suelen revelar información sobre el tipo de escaneo o de ataque. Los diferentes grupos de códigos de estado de conexión incluyen **Informativo 1xx**, **Correcto 2xx**, **Redirección 3xx**, **Error de cliente 4xx**, y **Error de servidor 5xx**. Para defenderse contra ataques basados en web, las contramedidas que deben utilizarse incluyen actualizar siempre el Sistema Operativo y los navegadores con los últimos parches y actualizaciones, usar un proxy web para bloquear sitios maliciosos, usar las buenas prácticas de seguridad del Proyecto Abierto de Seguridad de Aplicaciones Web (Open Web Application Security Project, OWASP) al desarrollar aplicaciones web, y capacitar a los usuarios finales enseñándoles cómo evitar ataques basados en la web.

Hay una serie de ataques que utilizan el correo electrónico para llevar payloads de malware o para obtener información personal. Los servidores SMTP también pueden tener vulnerabilidades y deben mantenerse actualizados con los parches. Los dispositivos de seguridad de correo electrónico pueden detectar y bloquear muchos tipos de amenazas de correo electrónico conocidas, como Phishing, Spam y malware.

Las aplicaciones web suelen conectarse a bases de datos. Debido a que estas bases de datos pueden contener información confidencial, son un objetivo frecuente de los ataques. Los ataques de inyección de código e inyección de SQL aprovechan campos de entrada que no tienen suficiente validación, y así enviar comandos a bases de datos u otras aplicaciones con el fin de obtener acceso a información privada. Los ataques de Cross-Site Scripting (Scripting entre sitios, XSS) se producen cuando los exploradores ejecutan scripts maliciosos en el cliente y proporcionan a los atacantes acceso a información confidencial en el host local.

El "Top 10 Web Application Security Risks" de OWASP está diseñado para ayudar a las organizaciones a crear aplicaciones web seguras. Es una lista útil de vulnerabilidades potenciales que son comúnmente aprovechadas por los atacantes.

# Comprendiendo que es defensa

## Defensa en profundidad

En este capítulo, aprendió la importancia de proteger nuestras redes, dispositivos y datos, contra agentes de amenaza. El punto de partida para la defensa de la red es la identificación de activos, vulnerabilidades y amenazas. Activo: cualquier elemento de valor para una organización que debe ser protegido, incluidos servidores, dispositivos de infraestructura, dispositivos terminales y el activo más importante, los datos. La administración de activos consiste en inventariar todos los activos y luego, desarrollar e implementar políticas y procedimientos para protegerlos. Vulnerabilidades: Una debilidad en un sistema o en su diseño que podría ser aprovechada por un atacante. Amenazas: Cualquier posible daño hacia un activo. Las organizaciones deben emplear un enfoque de defensa en profundidad para identificar amenazas y asegurar activos vulnerables. En este enfoque se utilizan varias capas de seguridad en el perímetro de la red, dentro de la red y en los puntos terminales de la red.

## Políticas, Regulaciones, y Estándares de Seguridad

Las organizaciones también deben tener un conjunto de políticas que definan las actividades autorizadas en la red. Estas incluyen las políticas de la empresa, las políticas de seguridad, las políticas de BYOD y las políticas que garanticen que la organización cumpla con las normas gubernamentales. Las políticas empresariales definen estándares de comportamiento correcto para la empresa y sus empleados. Las políticas de seguridad se usan para informar a los usuarios, al personal y a los gerentes los requisitos de una organización para proteger la tecnología y los activos de información. Algunas directivas de seguridad comunes incluyen la política de uso aceptable, la política de acceso remoto, la política de mantenimiento de red y los procedimientos de manejo de incidentes. El propósito de las políticas Bring your Own Device (BYOD) permiten a los empleados utilizar sus propios dispositivos móviles para tener acceso a sistemas, software, redes o información de la empresa. BYOD proporciona numerosos beneficios clave para las empresas, como el aumento de la productividad, la reducción de costos operacionales y de TI, la optimización de la movilidad para los empleados y mayor atractivo a la hora de contratar y retener empleados.

## Cumplimiento Normativo y de Estándares.

Las reglas de cumplimiento definen qué organizaciones deben hacerlo y qué responsabilidad tienen si no las cumplen. Las reglas de cumplimiento que una organización está obligada a seguir dependen del tipo de organización y de los datos que maneja.

# Control de acceso

## Control de acceso

La tríada de la CIA consiste de tres componentes primarios de la seguridad de la información: confidencialidad, integridad y disponibilidad. Los datos de la red se pueden encriptar (volverse ilegibles para usuarios no autorizados) mediante diversas aplicaciones de criptografía. La tendencia es que todos los datos sean cifrados. Zero Trust es un enfoque integral para garantizar el acceso a todas las redes, las aplicaciones y entornos. El principio Zero Trust es "nunca confiar, siempre verificar". Tradicionalmente, el perímetro de la red, o el borde, era la frontera entre el interior y el exterior, o confiable y no confiable. En un enfoque Zero Trust, cualquier lugar en el que se requiera una decisión de control de acceso debe considerarse un perímetro. Esto significa que, aunque un usuario u otra entidad puede haber pasado correctamente el control de acceso anteriormente, no se confía en que accedan a otra área o recurso hasta que se autentiquen. Los pilares de confianza son la zero trust para la fuerza de trabajo, la zero trust para las cargas de trabajo y la zero trust para el lugar de trabajo. Los métodos de control de acceso incluyen el control de acceso discrecional (DAC), el control de acceso obligatorio (MAC), el control de acceso basado en roles (RBAC), el control basado en atributos (ABAC), el acceso basado en reglas (RBAC) y el control de acceso basado en tiempo (TAC). Un ataque común se conoce como escalamiento de privilegios. En este ataque, se aprovechan vulnerabilidades en servidores o sistemas de control de acceso para conceder acceso a un usuario no autorizado o a un proceso no autorizado de software.

## Uso y Operación de AAA

Una red debe estar diseñada para controlar quién puede conectarse a ella y qué puede hacer cuando está conectado. Estos requisitos de diseño se identifican en la política de seguridad de la red. La política también puede ordenar la implementación de un sistema de contabilidad que haga un seguimiento de quienes se conectaron y cuándo, además que hicieron cuando iniciaron sesión. Los sistemas de autenticación, autorización y contabilidad (AAA) proporcionan el marco necesario para habilitar la seguridad escalable. La autenticación de AAA puede usarse para autenticar a los usuarios para el acceso local o puede usarse para autenticar a los usuarios para el acceso remoto a la red. 

Cisco proporciona dos métodos comunes para implementar servicios de AAA: Autenticación de AAA Local y Autenticación de AAA basada en servidor. La AAA centralizada tiene más capacidad de escala y administración que la AAA local, y por lo tanto, es la implementación de AAA preferida. Una AAA centralizada puede aprovechar Active Directory o el Protocolo Ligero de Acceso a Directorios (LDAP, en inglés) para la autenticación de usuarios y la membresía de grupos, manteniendo sus propias bases de datos de autorización y Contabilidad Los dispositivos se comunican con el servidor AAA centralizado usando el protocolo de Servicio de Autenticación Remota de Marcación de Usuario (RADIUS, Remote Authentication Dial-In User Service) o el Sistema de Control de Acceso del Controlador de Acceso Terminal Mejorado (TACACS+, Terminal Access Controller Access Control Systems). La AAA centralizada también permite el uso del método de contabilidad. La Contabilidad de AAA recopila datos de uso en los registros de AAA y los reporta. Varios tipos de información contable que se pueden recopilar son la Contabilidad de red, la Contabilidad de conexión, la Contabilidad EXEC, la Contabilidad del sistema, la Contabilidad de comandos y la Contabilidad de recursos.

# Inteligencia Contra amenazas

## Comunidades de Inteligencia de la red

Exiten muchas organizaciones de seguridad que ofrecen servicios de inteligencia de la red. Las organizaciones de seguridad de red incluyen SANS, Mitre, FIRST, SecurityNewsWire, (ISC)2 y CIS. Debemos estar al tanto de las amenazas más recientes y seguir mejorando nuestras habilidades. El Informe Anual de Ciberseguridad de Cisco y el Informe de Ciberseguridad a mitad de año son excelentes recursos utilizables. También es útil leer blogs y escuchar podcasts.

## Servicios de Inteligencia contra amenazas

Los servicios de inteligencia de amenazas permiten el intercambio de información, como vulnerabilidades, indicadores de riesgo (IOC, Indicator of compromise) y técnicas de mitigación. Esta información no solo se comparte con el personal, sino también con los sistemas de seguridad. A medida que surgen las amenazas, los servicios de inteligencia contra amenazas crean y distribuyen reglas de firewalls e IOC para los dispositivos que se han suscrito al servicio. Uno de estos servicios es Cisco Talos ﻿Grupo de inteligencia sobre amenazas.(Threat Intelligence Group).﻿ FireEye es otra empresa de seguridad que ofrece servicios para ayudar a las empresas a proteger sus redes. FireEye utiliza un enfoque triple que combina la inteligencia de seguridad, la experiencia en seguridad y la tecnología. FireEye ofrece SIEM y SOAR con la plataforma de seguridad Helix, que utiliza análisis de comportamiento y detección avanzada de amenazas, y cuenta con el apoyo de la red mundial de inteligencia contra amenazas FireEye Mandiant. El Departamento de Seguridad Nacional (The U.S Department of Homeland Security DHS) de Estados Unidos ofrece un servicio gratis llamado: Intercambio automático de indicadores (﻿Automated Indicator Sharing AIS). AIS permite el intercambio en tiempo real de los indicadores de ciberamenazas entre el gobierno federal de EE. UU. y el sector privado. El gobierno de los Estados Unidos patrocinó la Corporación MITRE para crear y mantener un catálogo de amenazas de seguridad conocidas, denominado CVE. Tres estándares comunes de intercambio de información sobre amenazas incluyen la Expresión Estructurada de Información sobre Amenazas (STIX), el intercambio Confiable Automatizado de Información de Indicadores (TAXII) y CybOX. Estos estándares abiertos proporcionan las especificaciones que ayudan en el intercambio automatizado de información de inteligencia de ciberamenazas en un formato estandarizado.

# Criptografía

## Cómo proteger las comunicaciones

Las organizaciones deben proporcionar soporte para proteger los datos a medida que viajan a través de enlaces. Los cuatro elementos de las comunicaciones seguras son: integridad de datos, autenticación de origen, confidencialidad de datos y no repudio de datos. La criptografía puede usarse casi en cualquier lugar donde haya comunicación de datos. Los hash criptográficos se usan para comprobar y garantizar la integridad de los datos. El hashing se basa en una función matemática unidireccional que es relativamente fácil de computar, pero mucho más difícil de revertir. La función de hash criptográfico puede utilizarse también para verificar la integridad Una función de hash toma un bloque variable de datos binarios, denominado mensaje, y produce una representación condensada de longitud fija, denominada hash. Hay cuatro funciones hash conocidas: MD5 con resumen de 128 bits, SHA-1, SHA-2 y SHA-3. Mientras que el hash se puede utilizar para detectar modificaciones accidentales, no brinda protección contra cambios deliberados hechos por un agente de amenaza. El hash es vulnerable a los ataques MITM. Para proporcionar integridad y autenticación de origen, se necesita algo más. Para agregar autenticación al control de integridad, se usa un Código de Autenticación de Mensajes basado en Hash (Hashed Message Authentication Codes HMAC) con clave. Los HMAC utilizan una clave secreta adicional como entrada a la función de hash.

## Confidencialidad de los datos

Hay dos clases de encriptación utilizadas para brindar confidencialidad de los datos: asimétrica y simétrica. Estas dos clases se diferencian en cómo utilizan las claves. Los algoritmos de encriptpación simétricos como DES, 3DES y el estándar AES se basan en la premisa de que cada parte que se comunica conoce la clave precompartida. La confidencialidad de los datos también se puede garantizar utilizando algoritmos asimétricos, incluidos RSA y PKI. Los algoritmos simétricos se usan normalmente con el tráfico de VPN porque utilizan menos recursos de CPU que los algoritmos de encriptación asimétrica. Los algoritmos de encriptación simétrica a menudo se clasifican como: cifrados por bloque o cifrados de flujo. Los algoritmos asimétricos, también llamados algoritmos de claves públicas, están diseñados para que la clave de encriptación y la de desencriptación sean diferentes. Los algoritmos asimétricos utilizan una clave pública y una privada. Algunos ejemplos de protocolos que utilizan algoritmos de claves asimétricos son: IKE, SSL, SSH, y PGP. Ejemplos comunes de algoritmos de encriptación asimétricos incluyen DSS, DSA, RSA, EIGaMal y técnicas de curva elíptica. Los algoritmos asimétricos se usan para brindar confidencialidad sin compartir previamente una contraseña. El proceso se puede resumir mediante la fórmula: Clave pública (Encriptar) + Clave privada (Desencriptar) = Confidencialidad El objetivo de autenticación de los algoritmos asimétricos se inicia cuando comienza el proceso de encriptación con la clave privada. El proceso se puede resumir mediante la fórmula: Clave privada (Encriptar) + Clave pública (Desencriptar) = Autenticación. Combinar los dos procesos de encriptación asimétrica proporciona confidencialidad, autenticación e integridad de los mensajes. Diffie-Hellman (DH) es un algoritmo de ecuación matemática asimétrico que permite que dos computadoras generen una clave secreta idéntica compartida sin antes haberse comunicado. Dos ejemplos de instancias cuando se utiliza DH son cuando los datos son intercambios mediante una VPN IPsec y cuando se intercambian datos SSH.

## Criptografía de clave pública

Las firmas digitales son una técnica matemática empleada para brindar 3 servicios de seguridad básicos: autenticidad, integridad, y no repudio (osea, que no se rechaze el mensaje al negar ser el remitente o el receptor) Las propiedades de la firma digital son: que son auténticas, inalterables, no reutilizables y no repudiadas. Las firmas digitales se utilizan comúnmente en las siguientes dos situaciones: firma de código y certificados digitales Existen tres algoritmos DSS que se utilizan para generar y verificar firmas digitales: Algoritmo de Firma Digital (Digital Signature Algorithm DSA), algoritmo Rivet-Shamir Adelman (Rivet-Shamir Adelman Algorithm RSA) y Algoritmo de Firma Digital de Curva Elíptica (Elliptical Curve Digital Signature Algorithm ECDSA). El código de firma digital proporciona garantías sobre el código de software: el código es auténtico y en realidad es originado por el editor, el código no ha sido modificado desde que salió del editor del software, y el editor innegablemente publicó el código. Un certificado digital es equivalente a un pasaporte electrónico. Permite que los usuarios, hosts y organizaciones intercambien información de manera segura en Internet. Específicamente, un certificado digital se usa para autenticar y verificar que los usuarios que envían un mensaje son quienes afirman ser.

## Autoridades y el sistema de confianza de PKI

Cuando se establece una conexión segura entre dos hosts, estos intercambian su información de clave pública. Existen terceros de confianza de Internet que validan la autenticidad de estas claves públicas mediante certificados digitales. La Infraestructura de Claves Públicas (Public Key Infrastructure PKI) consiste en especificaciones, sistemas, y herramientas que se utilizan para crear, administrar, almacenar, distribuir, utilizar, y revocar certificados digitales. La PKI es necesaria para admitir la distribución e identificación a gran escala de claves de encriptación públicas. El marco de trabajo de PKI permite una relación de confianza altamente escalable. Muchos proveedores proporcionan servidores de CA como un servicio administrado o como un producto para usuarios finales. Algunos de estos proveedores son: Symantec Group (VeriSign), Comodo, Go Daddy Group, GlobalSign y DigiCert, entre otros. El número de clase (entre 0 y 5) es determinado por el nivel de rigurosidad del procedimiento al momento de verificar la identidad del titular cuando se emitió el certificado, siendo que 5 es el mayor. Las PKI pueden formar distintas topologías de confianza. La más simple es la topología de PKI de raíz única. La interoperabilidad entre una PKI y sus servicios de soporte, por ejemplo el protocolo LDAP y los directorios X.500, es una preocupación porque muchos proveedores de CA han propuesto e implementado soluciones propias en lugar de esperar a que se desarrollen estándares. Para abordar esta preocupación sobre la interoperabilidad, la IETF publicó las Políticas de certificación y el Marco de trabajo de certificación de PKI, de Internet X>509 (RFC 2527).

## Aplicaciones e impactos de la criptografía

Hay muchos usos comunes de las PKI, incluidos algunos enunciados aquí: autenticación de pares basada en certificados SSL/TLS, tráfico web HTTPS, mensajes instantáneos seguros y protección de dispositivos de almacenamiento USB. Un analista de seguridad debe ser capaz de reconocer y resolver problemas potenciales relacionados a permitir el uso de soluciones relacionadas con PKI en la red empresarial. Por ejemplo: los agentes de amenaza pueden utilizar SSL/TLS para introducir violaciones de cumplimiento reglamentario, virus y malware, o provocar pérdida de datos e intentos de intrusión en una red. Otros problemas relacionados con SSL/TLS pueden asociarse a la validación del certificado de un servidor web. Algunos de los problemas relacionados con la PKI que están asociados a advertencias de seguridad son los siguientes: Algunos de estos problemas pueden evitarse gracias a que los protocolos SSL/TLS son extensibles y modulares. Esto se conoce como el conjunto de cifrado. Los componentes clave del conjunto de cifrado son el algoritmo MAC, el algoritmo de encriptación, el algoritmo de intercambio de claves y el algoritmo de autenticación. La criptografía es dinámica y siempre cambia. Debemos comprender bien los algoritmos y las operaciones para poder investigar los incidentes de seguridad relacionados con la criptografía. Las comunicaciones encriptadas pueden hacer que las cargas útiles de datos de seguridad de red sean ilegibles por los analistas de ciberseguridad. La encriptación se puede utilizar para ocultar comandos de malware y controlar el tráfico entre los hosts infectados y los servidores de control y comando. Además, el malware puede ocultarse mediante la encriptación y los datos pueden encriptarse durante la exfiltración, lo que dificulta su detección.

# Protección de terminales

## Protección Antimalware

Los terminales (endpoints) son hosts en la red que pueden tener acceso a otros hosts de la red y viceversa. Esto obviamente incluye computadoras y servidores. Con el rápido crecimiento de Internet de las Cosas (Internet of Things IoT), otros tipos de dispositivos ya son terminales de la red. Cada terminal es un posible lugar que el software malicioso tiene para obtener acceso a una red. No todos los extremos están dentro de una red. Muchos terminales se conectan a redes remotamente a través de VPN. El perímetro de la red se expande todo el tiempo. Se necesitan diversos dispositivos de seguridad de la red para proteger el perímetro de la red contra el acceso exterior. Sin embargo, muchos ataques se originan también dentro de la red. Por lo tanto, proteger una LAN interna es casi tan importante como proteger el perímetro externo de la red. Si un atacante se infiltra en un host interno, este puede ser el punto de partida para que obtenga acceso a dispositivos esenciales del sistema, como servidores y dispositivos con información confidencial. Hay dos elementos de LAN internos para proteger: Terminales e Infraestructura de la Red.

El software Antivirus/Antimalware se instala en un host, para detectar y mitigar virus y malware Lo hace utilizando tres enfoques diferentes, basados en firmas (utilizando diversas características de archivos de malware conocidos), basados en heurística (utilizando características generales compartidas por varios tipos de malware) y basados en comportamientos (utilizando un análisis de comportamientos sospechosos). Muchos programas antivirus son capaces de proporcionar protección en tiempo real analizando los datos al mismo tiempo que los terminales están siendo utilizados. Un Firewall basado en hosts limita las conexiones entrantes y salientes a conexiones iniciadas por ese host solamente. El software de firewall también puede evitar que un host se infecte e impedir que los hosts infectados propaguen malware a otros. La mayoría del software de seguridad basado en hosts incluye una funcionalidad de registro que es esencial para las operaciones de ciberseguridad. Los dispositivos de prevención de malware basado en la red también son capaces de compartir información entre ellos para permitir que se tomen mejores decisiones. La protección de terminales en una red sin fronteras puede lograrse usando técnicas basadas en la red y basadas en el host.

## Prevención de Intrusiones basada en hosts

Los firewalls basados en hosts pueden utilizar un conjunto de políticas o perfiles predefinidos para controlar los paquetes que entran y salen de una computadora. También pueden tener reglas que se pueden modificar o crear directamente para controlar el acceso según direcciones, protocolos y puertos. También pueden configurarse para emitir alertas a los usuarios si se detecta comportamiento sospechoso. Los datos del registro varían según la aplicación de firewall. Por lo general, se incluye la fecha y hora del evento, si la conexión se autorizó o denegó, información sobre las direcciones IP de origen o destino de los paquetes, y los puertos de origen y destino de los segmentos encapsulados. También se pueden utilizar firewalls distribuidos. Los firewalls distribuidos combinan características de firewalls basados en hosts con administración centralizada. Algunos ejemplos de firewalls basados en host incluyen Windows Defender Firewalls, iptables, nftables y TCP Wrappers. Un Sistema HIDS está diseñado para proteger a los hosts de malware conocido y desconocido. Un HIDS puede realizar una supervisión detallada e informes sobre la configuración del sistema y la actividad de la aplicación, el análisis de registros, la correlación de eventos, la comprobación de integridad, la aplicación de políticas, la detección de rootkit y las alertas. Un HIDS incluirá, con frecuencia, un servidor terminal de administración, como se ve en la figura. Debido a que el software HIDS debe ejecutarse directamente en el host, se considera un sistema basado en agente. Un HIDS utiliza estrategias proactivas y reactivas. Un HIDS puede prevenir intrusiones porque utiliza firmas para detectar malware conocido y evita que infecte un sistema. Las firmas son no eficaces contra amenazas nuevas o de dia cero. Además, algunas familias de malware se caracterizan por ser polimorfas. Otras estrategias para detectar la posibilidad de éxito incluyen la detección basada en anomalías y la detección basada en políticas.

## Seguridad de las aplicaciones

Una superficie de ataque es la suma total de las vulnerabilidades presentes en un sistema determinado a las que puede acceder un atacante. Puede consistir de puertos abiertos en servidores o hosts, software que se ejecuta en servidores conectados a internet, protocolos de redes inalámbricas e incluso usuarios. La superficie de ataque continúa expandiéndose. Hay más dispositivos que se conectan a las redes mediante dispositivos IoT y dispositivos BYOD. El Instituto SANS describe tres componentes de la superficie de ataque: superficie de ataque de red, superficie de ataque de software y superficie de ataque humano. Una manera de disminuir la superficie de ataque es limitar el acceso a posibles amenazas mediante la creación de listas de aplicaciones prohibidas. Estas listas se conocen como listas negras. Las listas negras de aplicaciones pueden determinar qué aplicaciones de usuario no tienen permitido ejecutar en una computadora. Del mismo modo, las listas blancas pueden especificar los programas que sí se pueden ejecutar. Las listas blancas se crean según un estándar de referencia establecido por una organización. Las listas negras se pueden crear manualmente o pueden obtenerse de diferentes servicios de seguridad. 

Sandboxing es una técnica que permite analizar y ejecutar en un entorno seguro los archivos sospechosos. Los sandbox de análisis de malware automatizado ofrecen herramientas que analizan el comportamiento del malware. Estas herramientas observan los efectos de ejecutar malware desconocido para poder determinar el comportamiento del malware y usar la información para crear defensas contra él. El malware polimorfo cambia con frecuencia y aparece nuevo malware regularmente Un perímetro extremadamente sólido y la implementación de sistemas de seguridad basados en hosts no evitan totalmente el ingreso de malware. Los HIDS y otros sistemas de detección pueden crear alertas sobre malware sospechoso que podría haber ingresado en la red y haberse ejecutado en un host.

# Evaluacion de Vulnerabilidades en terminales

## Perfiles de redes y servidores

Es importante realizar perfiles de red y dispositivos para proporcionar información estadística de referencia que pueda servir como punto de referencia para el rendimiento normal de la red y del dispositivo. Los elementos importantes del perfil de red incluyen la duración de la sesión, el rendimiento total, los puertos utilizados y el espacio de direcciones de activos críticos. La creación de perfiles de servidor se utiliza para establecer el funcionamiento aceptado de los servidores. Un perfil de servidor es una referencia de seguridad para un servidor específico. Establece la red, el usuario y los parámetros de aplicaciones que se aceptan para un servidor específico. Es posible describir el comportamiento de la red mediante una gran cantidad de datos diferentes, como las características del flujo de paquetes, las particularidades de los mismos paquetes y la telemetría derivada de múltiples fuentes. El análisis de big data se puede utilizar para realizar la detección de anomalías estadísticas, comportamentales y basadas en reglas.

La seguridad de la red se puede probar con numerosas herramientas y servicios. Risk analysis is the evaluation of the risk posed by vulnerabilities to a specific organization. Evaluación de vulnerabilidades, que emplea software para analizar servidores de Internet y redes internas en busca de diferentes tipos de vulnerabilidades. Las pruebas de penetración utilizan ataques simulados autorizados para probar la solidez de la seguridad de la red.

## Sistema de puntuación de vulnerabilidades comunes (Common Vulnerability Scoring System CVSS)

El Sistema común de puntuación de vulnerabilidades (Common Vulnerability Scoring System CVSS) es un marco abierto, independiente y estándar del sector que se utiliza para ponderar los riesgos de una vulnerabilidad mediante el uso de diversas métricas. CVSS produces standardized vulnerability scores that should be meaningful across organizations. En un framework abierto con el significado de cada métrica esta disponible para todos los usuarios. Permite priorizar el riesgo de una manera significativa para las organizaciones individuales. CVSS utiliza tres grupos de métricas para evaluar la vulnerabilidad. The metric groups are the base metric group, the temporal metric group, and the environmental metric group. El grupo de métricas base está diseñado como una forma de evaluar las vulnerabilidades de seguridad que se encuentran en los sistemas de software y hardware. Las vulnerabilidades se clasifican según el vector de ataque, la complejidad del ataque, los privilegios necesarios, la interacción del usuario y el alcance. Los grupos temporales y ambientales modifican la puntuación métrica base según el historial de la vulnerabilidad y el contexto de la organización específica. Una herramienta de calculadora CVSS está disponible en el PRIMER sitio web. La calculadora CVSS produce un número que describe la gravedad del riesgo que plantea la vulnerabilidad. Las puntuaciones van de cero a diez. Los rangos de puntuaciones tienen valores cualitativos de cero, bajo, medio, alto o riesgo crítico. En general, debe afrontarse cualquier vulnerabilidad que supere el valor de 3,9. Cuanto mayor sea el nivel de clasificación, mayor será la urgencia de obtener una solución. Otras fuentes importantes de información sobre vulnerabilidades son las Vulnerabilidades y Exposiciones Comunes (Common Vulnerabilities and Exposures CVE) y la Base Nacional de Datos sobre Vulnerabilidades (National Vulnerability Database NVD), ambas disponibles en línea.

## Administradores de dispositivos seguros

La gestión de riesgos implica seleccionar y especificar controles de seguridad para una organización. Existen cuatro formas posibles de responder a los riesgos, la evitación de riesgos significa interrumpir la actividad, el sistema o el servicio vulnerables porque el riesgo es demasiado alto. La reducción del riesgo significa tomar medidas para mitigar el riesgo con el fin de limitar su impacto. 

Compartir riesgos significa externalizar la responsabilidad del riesgo o utilizar un seguro para cubrir los daños causados por el riesgo. La retención de riesgos significa aceptar el riesgo y no tomar ninguna acción.

La gestión de vulnerabilidades es una práctica de seguridad diseñada para prevenir de forma proactiva la explotación de las vulnerabilidades de TI que existen dentro de una organización. El ciclo de vida de la gestión de vulnerabilidades consta de seis pasos: descubrir, priorizar activos, evaluar, informar, remediar y verificar. La administración de activos implica implementar sistemas que rastrean la ubicación y configuración de dispositivos y software en red en toda una empresa. Los sistemas de administración de dispositivos móviles (Mobile device management MDM) permiten al personal de seguridad configurar, monitorear y actualizar un conjunto muy diverso de clientes móviles desde la nube. La administración de configuraciones se ocupa del inventario y control de configuraciones de hardware y software de los sistemas. La administración de parches está relacionada con la administración de vulnerabilidades e implica todos los aspectos de la aplicación de parches de software, incluida la adquisición, distribución, instalación y verificación de parches. La administración de parches es requerida por algunas regulaciones de cumplimiento. Existen diferentes técnicas de administración de parches, como el análisis basado en agentes, sin agentes y la supervisión pasiva de redes.

## Sistemas de administración de seguridad de la información

Las organizaciones pueden utilizar un sistema de administración de seguridad de la información (Information Security Management System ISMS) para identificar, analizar y afrontar los riesgos de seguridad de la información. ISO y NIST tienen disponibles los estándares para la administración de riesgos de ciberseguridad. Un ISMS es un enfoque sistemático de múltiples capas para la seguridad cibernética que incluye personas, procesos, tecnologías y las culturas en las que interactúan en un proceso de gestión de riesgos. La Organización Internacional de Normalización (International Organization for Standardization ISO) se asoció con la Comisión Electrotécnica Internacional (International Electrotechnical Commission IEC) para desarrollar la serie ISO / IEC 27000 de especificaciones para SGSI. NIST también ha desarrollado el marco de ciberseguridad, que es similar a los estándares ISO/IEC 27000. El marco NIST es un conjunto de estándares diseñados para integrar estándares, pautas y prácticas existentes para ayudar a administrar mejor y reducir el riesgo de ciberseguridad.

# Tecnologias y protocolos

## Monitoreo de protocolos comunes

Muchos tipos de dispositivos de muchos proveedores diferentes pueden utilizar syslog para enviar entradas del registro a servidores centrales que ejecutan un daemon de syslog. Esta centralización de la recopilación de registros ayuda a poner en práctica el monitoreo de la seguridad. Debido a que syslog es tan importante para el monitoreo de la seguridad, los servidores syslog pueden ser un blanco de los agentes de amenaza. Los hackers pueden intentar bloquear la transferencia de datos de clientes syslog a servidores, manipular o destruir los datos de registro, o manipular el software que crea y transmite los mensajes de registro. Los mensajes de syslog suelen tener marca de hora. Dado que los mensajes pueden provenir de muchos dispositivos, es importante que los dispositivos compartan un reloj único. Una forma de lograr esto es que los dispositivos usen el protocolo de tiempo de red (NTP). Dado que los eventos conectados a un ataque pueden dejar rastros en cada dispositivo de la red mientras recorren su camino al sistema de destino, las marcas de tiempo son esenciales para la detección. Los actores de amenazas pueden intentar atacar la infraestructura NTP para corromper la información de tiempo que se usa para correlacionar eventos de red registrados o usar sistemas NTP para dirigir ataques DDoS a través de vulnerabilidades en el software del cliente o servidor.

Los atacantes comúnmente encapsulan diferentes protocolos de red dentro del DNS para evadir los dispositivos de seguridad. Actualmente, muchos tipos de malware usan el DNS. Algunas variantes de malware emplean el DNS para comunicarse con servidores de comando y control (CnC) y para exfiltrar datos de tráfico disfrazados de consultas de DNS normales. Se pueden utilizar varios tipos de codificación para camuflar los datos y evadir las medidas básicas de prevención de pérdida de datos (DLP). Es probable que la parte del subdominio de dichas consultas sea mucho más larga que las solicitudes habituales.

El protocolo de transferencia de hipertexto (HTTP) es el protocolo troncal de la red informática mundial (World Wide Web). HTTP no protege los datos de atacantes que deseen alterarlos o interceptarlos, lo que constituye una grave amenaza a la privacidad, identidad y seguridad de la información. Un ataque común de HTTP se denomina inyección de iFrame (inline Frame). Un actor de amenazas pone en peligro un servidor web y planta un código malicioso que crea un iFrame invisible en una página web visitada con frecuencia. Cuando se carga el iFrame, se descarga el malware. Para hacer frente a la alteración o la interceptación de datos confidenciales, muchas organizaciones comerciales han adoptado HTTPS o implementado políticas exclusivas de HTTPS para proteger a quienes visitan sus sitios web y servicios. HTTPS agrega una capa de cifrado al protocolo HTTP mediante el uso de capa de socket seguro (SSL), lo que hace que los datos HTTP sean ilegibles ya que dejan el equipo de origen hasta que llega al servidor. Por desgracia, el tráfico HTTPS encriptado complica el monitoreo de seguridad de la red. Algunos dispositivos de seguridad incluyen la decriptación e inspección de SSL; sin embargo, esto puede traer problemas de procesamiento y privacidad. Además, HTTPS añade complejidad a las capturas de paquetes debido a la mensajería adicional implicada en el establecimiento de la conexión encriptada.

Los protocolos de correo electrónico como SMTP, POP3 e IMAP pueden usarse para diseminar malware, exfiltrar datos u ofrecer canales a servidores de CnC de malware. El SMTP envía datos desde un host hacia un servidor de correo y entre servidores de correo. Dado que hay tanto tráfico de SMTP, no siempre se monitorea. Sin embargo, el malware ha usado el SMTP en el pasado para exfiltrar datos de la red. El monitoreo de la seguridad podría revelar este tipo de tráfico según las características del mensaje de correo electrónico. IMAP y POP3 se usan para descargar mensajes de correo electrónico de un servidor de correo a una computadora host. El monitoreo de seguridad puede identificar cuándo un archivo adjunto de correo electrónico malicioso ingresó a la red y qué host infectó primero. Luego, el análisis retrospectivo puede rastrear el comportamiento del malware desde ese momento.

La funcionalidad ICMP se ha utilizado para crear varios tipos de exploits. ICMP puede emplearse para identificar los hosts de una red o la estructura de una red, y determinar los sistemas operativos utilizados en la red. También puede usarse como vehículo para varios tipos de ataques de DoS. También puede usarse para la exfiltración de datos. Debido a la preocupación de que ICMP puede utilizarse para vigilar o denegar un servicio desde el exterior de la red, suele dejarse de lado el tráfico ICMP desde el interior de la red. Sin embargo, algunas variedades de malware utilizan paquetes ICMP diseñados para transferir archivos de hosts infectados a los agentes de amenaza usando este método, que se conoce como tunelización de ICMP.

## Tecnologías de seguridad

Las listas ACL pueden dar una falsa sensación de seguridad si se confía demasiado en ellas. Los atacantes pueden determinar qué direcciones IP, protocolos y puertos están autorizados por las ACL. Esto puede realizarse mediante análisis de puertos o pruebas de penetración, o mediante otros métodos de reconocimiento. Los atacantes pueden crear paquetes que utilicen direcciones IP de orígenes falsificados. Las aplicaciones pueden entablar conexiones en puertos arbitrarios. Otras características del tráfico de protocolo también pueden manipularse, como el marcador establecido en segmentos de TCP. Las reglas no pueden preverse y configurarse para todas las técnicas de manipulación de paquetes que surgen.

La traducción de direcciones de red (NAT) y la traducción de direcciones de puerto (PAT) pueden complicar el monitoreo de la seguridad. Varias direcciones IP se asignan a una o más direcciones públicas que son visibles en Internet, ocultando las direcciones IP individuales que están dentro de la red (direcciones internas). Este problema puede ser particularmente importante con los datos de NetFlow. Los flujos de NetFlow son unidireccionales y se definen por las direcciones y puertos que comparten. Básicamente, NAT romperá un flujo que pase por un gateway de NAT y hará que la información del flujo no esté disponible desde ese momento en adelante.

El cifrado puede presentar desafíos para la supervisión de la seguridad al hacer ilegibles los detalles del paquete. La encriptación es parte de las tecnologías de VPN. En las VPN, un protocolo común (como IP) se utiliza para transportar tráfico encriptado. Fundamentalmente, el tráfico encriptado establece una conexión de punto a punto virtual entre redes en instalaciones públicas. La encriptación hace que el tráfico sea ilegible para todos los dispositivos, salvo los terminales de la VPN. Una tecnología similar se puede utilizar para crear una conexión virtual de punto a punto entre un host interno y los dispositivos del agente de amenaza. El malware puede establecer un túnel cifrado que transita por un protocolo común y de confianza, y utilizarlo para exfiltrar datos desde la red.

En las redes peer-to-peer (P2P), los hosts pueden operar tanto en roles de cliente como de servidor. Existen tres tipos de aplicaciones P2P: uso compartido de archivos, uso compartido de procesadores y mensajería instantánea. En las redes P2P de uso compartido de archivos, los archivos de una máquina participante se comparten con los miembros de la red P2P. Cada vez que se les otorga acceso a los recursos de la red a usuarios desconocidos, la seguridad está en riesgo. No se deben permitir aplicaciones P2P de intercambio de archivos en redes corporativas. La actividad de redes P2P puede sortear las protecciones de firewall y es un medio habitual para propagar malware. La red P2P es intrínsecamente dinámica. Los archivos compartidos suelen estar infectados con malware y los agentes de amenaza pueden colocar su malware en clientes P2P para distribuirlo a otros usuarios.

Tor es una plataforma de software y una red de hosts P2P que funcionan como enrutadores de Internet en la red Tor. Esto permite a los usuarios navegar por Internet de forma anónima. Los usuarios tienen acceso a la red Tor mediante un navegador especial. El navegador construye una ruta en capas de extremo a extremo a través de la red del servidor Tor que está encriptada. Cada capa encriptada se “pela” como las capas de una cebolla (por eso el nombre “enrutamiento tipo cebolla”) a medida que el tráfico atraviesa un retransmisor de Tor. Las capas contienen información encriptada de siguiente salto que solamente puede leer el router que necesita leer la información. Cuando el tráfico regresa al origen, se crea una ruta con capas encriptadas nuevamente. Tor presenta una serie de desafíos para los analistas de ciberseguridad. Primero, Tor es ampliamente utilizado por organizaciones delictivas en la “red oscura”. Además, Tor se ha utilizado como un canal de comunicaciones para CnC de malware. Debido a que la dirección IP de destino del tráfico de Tor está oculta por la encriptación y solamente se conoce el nodo del siguiente salto de Tor, el tráfico de este navegador evita las listas negras que se han configurado en los dispositivos de seguridad.

El equilibrio de carga implica la distribución del tráfico entre dispositivos o rutas de redes para no sobrecargar los recursos de redes con demasiado tráfico. Una forma de hacerlo en Internet es a través de varias técnicas que utilizan DNS para enviar tráfico a recursos que tienen el mismo nombre de dominio pero varias direcciones IP. Esto puede resultar en que una sola transacción de Internet esté representada por múltiples direcciones IP en los paquetes entrantes, lo que puede hacer que aparezcan características sospechosas en las capturas de paquetes. Algunos dispositivos de administrador de equilibrio de carga (LBM) usan sondas para probar el rendimiento de diferentes rutas y el estado de diferentes dispositivos. Estas sondas pueden parecer tráfico sospechoso si el analista de ciberseguridad no está al tanto de que este tráfico es parte del funcionamiento del dispositivo de LBM.

# Datos de seguridad de la red

## Tipos de datos de seguridad

Los datos de alertas son mensajes generados por sistemas de prevención de intrusiones (IPS) o sistemas de detección de intrusiones (IDS) para responder al tráfico que viola una regla o coincide con la firma de un ataque conocido. Snort genera las alertas y es posible leerlas y buscarlas con aplicaciones como Sguil, Squert y Kibana que forman parte del conjunto Security Onion de herramientas de NSM.

Los datos de sesión son un registro de una conversación entre dos terminales de red que suelen ser un cliente y un servidor. El servidor puede encontrarse dentro de la red empresarial o en un lugar al que se tiene acceso por Internet. Los datos de la sesión incluyen información de identificación, como las cinco tuplas de direcciones IP de origen y destino, los números de puerto de origen y de destino, y el código IP del protocolo en uso. Los datos sobre la sesión suelen incluir un identificador de la sesión, la cantidad de datos transferidos por el origen y el destino, e información relativa a la duración de la sesión.

La captura de paquetes completos es el tipo de captura que obtiene los datos más detallados de la red. Las capturas completas de paquetes requieren el mayor almacenamiento. La captura completa de paquetes contiene todo el material de las conversaciones, como los mensajes de texto o correo electrónico, el HTML de las páginas web y los archivos que ingresan o salen de la red. El contenido que se extrae de las capturas de paquetes completos puede recuperarse y analizarse en busca de malware o comportamiento del usuario que viole las políticas de la empresa y de seguridad.

Los datos estadisticos son creados a través del analisis de varias formas de datos de red Las características estadísticas del comportamiento normal de una red se pueden comparar con el tráfico de red actual en un esfuerzo por detectar anomalías. Las estadísticas pueden utilizarse para caracterizar volúmenes normales de variación en los patrones de tráfico de red con el fin de identificar las condiciones de red que están significativamente fuera de esos rangos. Las diferencias estadísticamente significativas deben desencadenar alarmas e impulsar la investigación.

## Registros de terminales

El sistema de detección de intrusiones basado en hosts(Host-based Intrusion detection system, HIDS), se ejecuta en hosts individuales. HIDS no solo detecta intrusiones sino que, en la forma de firewalls con base en hosts, también puede prevenirlas. Este software crea registros y los guarda en el host. Muchas protecciones basadas en host tienen una forma de enviar registros a servidores de administración de registros centralizados, lo que proporciona una forma de buscar registros desde una ubicación central mediante herramientas de NSM. OSSEC, un HIDS de código abierto muy conocido, incluye una funcionalidad muy resistente de recopilación y análisis de registros.

Syslog incluye especificaciones para formatos de mensajes, una estructura de aplicación de cliente y servidor, y un protocolo de red. Muchos tipos diferentes de dispositivos de red pueden configurarse para utilizar el estándar de syslog a fin de registrar eventos en los servidores de syslog centralizados.

Los registros del servidor son una fuente esencial de información para el monitoreo de la seguridad de la red. Los servidores de aplicaciones de una red, como los web y los de correo electrónico, tienen archivos de registro de acceso y de errores. El servidor proxy DNS registra todas las consultas y respuestas de DNS que ocurren dentro de la red. Los registros del proxy de DNS son útiles para la identificación de hosts que podrían haber visitado sitios web peligrosos y para la identificación de exfiltración de datos de DNS y conexiones a servidores de comando y control de malware.

SIEM combina las funciones esenciales de las herramientas de administración de eventos de seguridad (SEM) y administración de información de seguridad (SIM) para brindar una perspectiva comprensible de las redes empresariales usando recolectores de registros, normalización, correlación, agregación, reporte y conformidad

## Registros de redes

La herramienta de línea de comando tcpdump es un analizador de paquetes muy popular. Puede mostrar capturas de paquetes en tiempo real o escribir capturas de paquetes en un archivo. Las capturas incluyen protocolos de paquetes detallados y datos de contenido que se pueden ver con Wireshark.

NetFlow proporciona de manera eficiente un importante conjunto de servicios para aplicaciones IP, en el que se incluye auditoría de tráfico de red, facturación de redes con base en el uso, planificación de la red, seguridad, funcionalidades de monitoreo de denegación de servicio y monitoreo de la red. NetFlow brinda información valiosa acerca de los usuarios y las aplicaciones de la red, horarios pico de uso y routing de tráfico.

Control y visibilidad de aplicaciones de Cisco utiliza el reconocimiento version 2 basado en la red (NBAR2), también conocido como Next-Generation NBAR, para descubrir y clasificar las aplicaciones en uso en la red. El motor de reconocimiento de aplicaciones NBAR2 admite más de 1000 aplicaciones de red.

Los dispositivos como Cisco Email Security Appliance (ESA) y Cisco Web Security Appliance (WSA), ofrecen una amplia gama de funcionalidades para el monitoreo de la seguridad utilizando filtro de contenido. Se pueden generar archivos de registro para muchas de estas funcionalidades.

Los servidores proxy son dispositivos que actúan como intermediarios para los clientes de la red. Una empresa puede configurar un proxy web para manejar las solicitudes web en nombre de los clientes. En lugar de enviar las solicitudes de recursos web directamente al servidor desde el cliente, la solicitud se envía primero a un servidor proxy. El servidor proxy solicita los recursos y los devuelve al cliente. El servidor proxy genera registros de todas las peticiones y respuestas que luego pueden analizarse para determinar qué hosts realizan las solicitudes y si los destinos son seguros o podrían ser maliciosos, y también para entender mejor qué tipos de recursos se descargan.

Los dispositivos de Firewall NextGen extienden la seguridad en la red más allá de las direcciones IP y los números de puerto de capa 4 hasta la capa de aplicación y más allá. Los Firewall NextGen son dispositivos avanzados que proporcionan mucha más funcionalidad que las generaciones anteriores de dispositivos de seguridad de red. Los NextGen tiene tableros de reporte Firewall con funciones interactivas que permiten un rápido sistema de reportes en un clic sobre información muy específica sin la necesidad de SIEM u otros eventos de correlación.

# Evaluacion de alertas

## Fuentes de las alertas

Security Onion es una suite de código abierto de herramientas de Monitoreo de la seguridad de la red (Network Security Monitoring, NSM) que se ejecuta en una distribución Ubuntu de Linux. Las herramientas de Security Onion ofrecen tres funciones principales para el análisis de ciberseguridad como la captura completa de paquetes y tipos de datos, sistemas de detección de intrusión basados en el host y basados en la red, y herramientas de análisis de alerta. Algunos de los componentes de Security Onion son propiedad de corporaciones que los mantienen, como Cisco y Riverbend Technologies, pero está disponible como una plataforma de código abierto.

Security Onion contiene muchos componentes. Es un entorno integrado diseñado para simplificar la implementación de una solución integral de NSM. Security Onion integra estos diferentes tipos de datos y registros del sistema de detección de intrusiones (IDS) en una única plataforma mediante las siguientes herramientas: Sguil - Sirve para punto de inicio de investigación de alertas de seguridad Kibana - Kibana es una interfaz interactiva para datos de Elasticsearch. Permite la consulta de datos de NSM y proporciona visualizaciones flexibles de esos datos. La aplicación capturadora de paquetes Wireshark está integrada en el conjunto de Security Onion. Zeek es un analizador de tráfico de red que sirve como monitor de seguridad. Zeek inspecciona todo el tráfico en un segmento de red y permite un análisis detallado de esos datos.

Las alertas de seguridad son los mensajes de notificación que generan las herramientas, los sistemas y los dispositivos de seguridad de NSM. En Security Onion, Sguil proporciona una consola que integra alertas de varias fuentes en una cola con marca de hora. Un analista de ciberseguridad puede navegar por la cola de seguridad investigando, clasificando, derivando o retirando alertas.

Las alertas suelen incluir información de cinco tuplas cuando esté disponible, así como marcas de hora y la información necesaria para identificar qué dispositivo o sistema generó la alerta. Según la tecnología de seguridad, es posible generar alertas con base en reglas, firmas, anomalías o comportamientos. Las alertas pueden provenir de varios orígenes, como NIDS, administración y supervisión de activos, transacciones HTTP, DNS y TCP, y mensajes Syslog.

Snort es un sistema de detección de intrusiones en la red (NIDS, Network Intrusion Detection System). Es una fuente importante de los datos de alerta que se indexan en la herramienta de análisis Sguil. Utiliza reglas para identificar el tráfico potencialmente malicioso. Las reglas de Snort consisten de dos secciones: el encabezado de la regla y las opciones de la regla. El encabezado de la regla contiene la acción, el protocolo, las direcciones IP y máscaras de red de origen y destino, y la información del puerto de origen y de destino. La sección de opciones de la regla contiene mensajes de alerta e información sobre qué partes del paquete deben ser inspeccionadas para determinar si debe adoptarse la acción de la regla. La estructura de la sección de opciones de la regla es variable.

## Descripción general de la evaluación de alertas

El panorama de amenazas cambia constantemente con la detección de nuevas vulnerabilidades y la evolución de nuevas amenazas. A medida que las necesidades de usuarios y organizaciones cambian, también lo hace la superficie de ataque. Los agentes de amenaza han aprendido a cambiar rápidamente las características de sus ataques para evadir la detección. Las reglas de detección deben ser excesivamente conservadoras. Es mejor que se generen alertas ocasionales por tráfico inocente que tener reglas que no detecten tráfico malicioso. Por este motivo, es necesario tener analistas de ciberseguridad calificados que investiguen las alertas para determinar si realmente se produjo un ataque.

Los incidentes de seguridad se clasifican con un esquema adoptado del ámbito de los diagnósticos médicos. Este esquema de clasificación se utiliza para guiar acciones y evaluar los procedimientos de diagnóstico. La inquietud radica en que el diagnóstico sea exacto (verdadero) o inexacto (falso). Las alertas se pueden clasificar como Verdadero Positivo (se ha verificado que la alerta es un incidente de seguridad real) o Falso Positivo (La alerta no indica un incidente de seguridad real). Otra situación puede ser que no se haya generado una alerta. La ausencia de una alerta se puede clasificar como: Verdadero negativo (no se ha producido ningún incidente de seguridad. La actividad es benigna.) y falso negativo (Un incidente no detectado que ha ocurrido) Los verdaderos positivos y los verdaderos negativos son deseables. Los falsos positivos no son deseables, pero inevitables, y los falsos negativos son peligrosos.

Se pueden utilizar técnicas estadísticas para evaluar el riesgo de que los ataques tengan éxito en una red dada. Este tipo de análisis puede ayudar a los encargados de la toma de decisiones a evaluar mejor el costo de mitigar una amenaza respecto del daño que podría causar un ataque. Hay dos enfoques generales para esto el análisis determinista y el análisis probabilístico. El análisis determinista evalúa el riesgo según lo que se conoce acerca de una vulnerabilidad. Supone que, para que un ataque tenga éxito, todos los pasos anteriores del ataque también deben tener éxito. Este tipo de análisis de riesgo solamente puede describir el peor de los casos. El análisis probabilístico evalúa el éxito potencial de un ataque calculando la probabilidad de que, si un paso de un ataque concluye con éxito, el siguiente paso también lo hará. El análisis probabilístico es especialmente útil en los análisis de seguridad de la red en tiempo real, en los que numerosas variables están en juego y un agente de amenaza puede tomar decisiones desconocidas a medida que se persigue un ataque.

# Trabajo con datos de seguridad de la red

## Una plataforma común para los datos

Debido a la diversidad de datos de supervisión de red, una plataforma de supervisión de seguridad de red debe unir los datos para su análisis. ELK, o The Elastic Stack, es una plataforma de este tipo. ELK consiste en Elasticsearch, Logstash y Kibana con Beats, ElastAlert y Curator. Estos componentes permiten la recopilación, normalización y análisis de datos de supervisión de red. Elasticsearch permite una búsqueda rápida de grandes cantidades de datos. Los módulos Logstash y Beats compilan y normalizan datos de muchas fuentes, y Kibana proporciona una interfaz gráfica de usuario y herramientas para analizar los datos. Los datos de red deben reducirse para que el sistema NSM procese solo los datos relevantes. Los datos de red también deben normalizarse para convertir los mismos tipos de datos a formatos coherentes. Los datos deben archivarse durante un tiempo razonable y ese período puede especificarse mediante marcos de cumplimiento. Security Onion está configurado para eliminar datos automáticamente si el espacio disponible en disco es demasiado bajo. Curator eliminará los índices Logstash que tienen más de 30 días de forma predeterminada.

## Investigación de datos de la red

Sguil proporciona una consola que permite a un analista de ciberseguridad investigar, verificar y clasificar alertas de seguridad. Sguil correlaciona eventos basados en información como direcciones IP de origen y destino y puertos de capa 4, entre otros. Esto despeja la consola del analista al representar eventos relacionados en una sola línea. La columna CNT indica el número de eventos que se han correlacionado para una alerta. Se muestra la primera alerta de la serie. Toda la serie se puede ver en Sguil haciendo clic con el botón derecho en el valor CNT y seleccionando Ver eventos correlacionados. Pivotaje que implica pasar de la información en una aplicación a diferentes herramientas especializadas para ver detalles de esa información. Sguil proporciona formas de gestionar las alertas escalándolas, retirándolas y clasificándolas.

Kibana solo muestra datos de las últimas 24 horas de forma predeterminada. Esto es para evitar que la pantalla se desordene. Al investigar los datos que se produjeron antes de ese período, el analista debe establecer el intervalo de tiempo. Se pueden crear paneles personalizados con una variedad de visualizaciones. Hay varias formas de consultar Elasticsearch mediante Query DSL (Domain Specific Language). Se pueden especificar numerosos operadores, campos, comodines y otros términos. Las consultas se pueden ejecutar enviándolas directamente a un URI RESTful o a través de cURL, cuerpos de consulta JSON. o utilizando Kibana Dev Tools. Las llamadas a procesos y API se pueden investigar trabajando con alertas OSSEC HIDS. Además, se puede acceder a los detalles de los archivos, como tipos de archivos y hashes a través de Kibana y se pueden enviar a una fuente externa para ser identificados como benignos o como malware. Una de esas fuentes es VirusTotal.

## Cómo mejorar el trabajo del analista de ciberseguridad

Las visualizaciones de Kibana proporcionan información sobre los datos de NSM al representar grandes cantidades de formatos de datos que son más fáciles de interpretar. Algunos paneles proporcionan la posibilidad de hacer clic en elementos interactivos que proporcionarán información enfocada. La gestión del flujo de trabajo añade eficiencia al trabajo del equipo SOC. La automatización de Runbook, o los sistemas de gestión de flujo de trabajo, proporcionan herramientas para optimizar y controlar los procesos SOC. Las consultas automatizadas también ayudan para agregar eficiencia. Estas consultas, denominadas estrategias o cuadernos de estrategias, buscan automáticamente incidentes de seguridad complejos que puedan sortear otras herramientas.

# Análisis y respuesta de incidentes e informática forense digital

## Manejo de evidencia y atribución del ataque

La informática forense digital consiste en la recuperación e investigación de la información que se encuentra en dispositivos digitales en relación con actividades delictivas. Los indicadores de compromiso son la evidencia de que se ha producido un incidente de ciberseguridad. Es esencial que se conserven todos los indicadores de compromiso para futuros análisis y atribución de ataques. 

Una organización necesita desarrollar procesos bien documentados para el análisis forense digital. La publicación especial 800-86 de NIST Guía para la Integración de Técnicas Forenses en Respuesta a Incidentes es un recurso valioso para las organizaciones que requieren orientación en el desarrollo de planes forenses digitales. El proceso forense incluye cuatro pasos: recolección, examen, análisis y presentación de informes. En los procedimientos legales y en términos generales, la evidencia se clasifica como directa o indirecta. La evidencia se clasifica además como mejor evidencia (evidencia que está en su estado original), y evidencia corroborante (evidencia que apoya una afirmación que se desarrolla a partir de la mejor evidencia). IETF RFC 3227 Describe un orden para la recopilación de evidencia digital según la volatilidad de los datos. La cadena de custodia implica la recopilación, el manejo y el almacenamiento seguro de la evidencia.

La atribución de una amenaza hace referencia a la acción de determinar a la persona, organización o nación responsable de una intrusión o ataque exitosos. La identificación de los actores responsables de una amenaza debe darse por medio de la investigación sistemática y fundamentada de la evidencia. En las investigaciones con base en evidencias, el equipo de respuesta ante los incidentes correlaciona las tácticas, las técnicas y los procedimientos (TTP, Tactics, Techniques and Procedures) empleados en el incidente con los de otros ataques conocidos. Las fuentes de inteligencia de amenazas pueden ayudar a relacionar las TTP identificadas por una investigación con fuentes conocidas de ataques similares. Para las amenazas internas, la administración de activos desempeña un papel fundamental. Descubrir los dispositivos desde donde se inició un ataque puede llevar directamente al agente de amenaza. Una forma de atribuir un ataque es modelar el comportamiento del actor de amenazas. El marco de tácticas adversariales, técnicas y conocimiento común (ATT&CK) de MITRE permite detectar tácticas, técnicas y procedimientos del atacante como parte de la defensa de amenazas y la atribución de ataques.

## La Cadena de eliminación cibernética

La cadena de ciber eliminación (Cyber Kill Chain) fue desarrollada para identificar y evitar ciber intrusiones. Hay siete pasos a la cadena de eliminación cibernética. Enfocarse en estos pasos ayuda a los analistas a entender las técnicas, herramientas y procedimientos de los atacantes. Al responder a un incidente de seguridad, el objetivo es detectar y detener el ataque lo antes posible en el transcurso de la cadena de eliminación. Cuanto antes se detenga el ataque, menor será el daño y menor será la información que el atacante obtenga acerca de la red atacada.

Los pasos de la cadena de ciber eliminación (Cyber Kill Chain) son reconocimiento, armamento, entrega, explotación, instalación, comando y control, y acciones sobre objetivos. El reconocimiento tiene lugar cuando el agente de amenaza realiza una búsqueda, reúne inteligencia y selecciona objetivos. Esto le permite determinar al agente si vale la pena realizar el ataque. El objetivo de armamento es utilizar la información de reconocimiento para desarrollar un arma contra sistemas o individuos que sean blancos específicos en la organización. Durante la entrega, el arma es transmitida a los objetivos utilizando un vector de entrega. Una vez aplicada el arma, el actor de la amenaza la utiliza para quebrar la vulnerabilidad y obtener el control del objetivo. La instalación ocurre cuando el atacante establece una puerta trasera al sistema para poder seguir accediendo al objetivo. Para preservar esta puerta trasera, es importante que el acceso remoto no alerte a los analistas de ciberseguridad ni a los usuarios. Comando y Control, o CnC, establece el control del atacante sobre el objetivo del sistema. El agente de amenaza utiliza los canales de CnC para emitir comandos al software que instala en el objetivo. Acciones sobre objetivos describe el agente amenazador que logra su objetivo original. Este puede ser el robo de datos, la ejecución de un ataque de DDoS, o el uso de la red atacada para crear y enviar correo electrónico no deseado o mina de Bitcoin.

## Análisis del modelo de diamante de las intrusiones

El modelo de diamante de análisis de intrusiones representa un incidente o un evento de seguridad. Un evento es una actividad de tiempo limitado que está restringido a un paso específico donde el adversario utiliza la capacidad sobre la infraestructura para atacar una víctima para lograr un resultado específico. Las cuatro características principales de un evento de intrusión son el adversario (las partes responsables de la intrusión), la capacidad (la herramienta o técnica utilizada para atacar a la víctima), la infraestructura (la ruta de red o rutas utilizadas para establecer y mantener CNC) y la víctima (el objetivo del ataque). Las metacaracterísticas, que amplían ligeramente el modelo, incluyen Marca de tiempo, Fase, Resultado, Dirección, Metodología y Recursos (uno o más recursos externos utilizados por el adversario para el evento de intrusión).

Como analistas especializados en ciberseguridad, es posible que se les pida que utilicen el Modelo de diamante de análisis de intrusión para diagramar una serie de eventos de intrusión. Los adversarios no ejecutan un solo evento. En cambio, los eventos se entretejen en una cadena en la que cada evento debe completarse con éxito antes del siguiente. Esta serie de eventos puede asignarse a la cadena de ciber eliminación.

## Respuesta ante los incidentes

La respuesta a incidentes implica los métodos, políticas y procedimientos que utiliza una organización para responder a un ataque cibernético. Los objetivos de la respuesta ante incidentes son limitar el impacto del ataque, evaluar los daños causados e implementar procedimientos de recuperación. Es esencial que las organizaciones creen y mantengan planes detallados de respuesta a incidentes y designen al personal responsable de ejecutar todos los aspectos de ese plan. Las recomendaciones del NIST (U.S. National Institute of Standards and Technology ) para la respuesta ante los incidentes se detallan en su Publicación especial 800-61 (Revisión 2) titulada “Guía de manejo de incidentes de seguridad informática”

El primer paso para una organización es establecer una capacidad de respuesta ante los incidentes de seguridad informática (CSIRC, computer security incident response capability). NIST recomienda crear políticas (detallando cómo se manejan los incidentes), planes (definiendo claramente las tareas y responsabilidades) y procedimientos (acciones específicas a tomar) para establecer y mantener un CSIRC. Otros grupos e individuos dentro de la organización también pueden estar involucrados en el manejo de incidentes. Sus conocimientos y habilidades pueden ayudar al CSIRT (Computer Security Incident Response Team) a manejar el incidente rápida y correctamente. Algunas de las partes interesadas incluyen administración, aseguramiento de la información, soporte de TI, el departamento legal, asuntos públicos y relaciones con los medios, recursos humanos, planificadores de continuidad comercial, seguridad física y administración de instalaciones. El equipo legal debe consultar las regulaciones gubernamentales para determinar la responsabilidad de la organización de informar el incidente. Más allá de los requisitos legales y las consideraciones sobre las partes interesadas, el NIST recomienda que una organización trabaje en conjunto con otras para compartir información sobre incidentes. Cada organización debe tener desarrollada una política que detalle cuánto tiempo debe conservarse la evidencia de un incidente.

El marco de certificación del modelo de madurez de ciberseguridad (CMMC) fue creado para evaluar la capacidad de las organizaciones que desempeñan funciones para el Departamento de Defensa de los Estados Unidos (DoD) para proteger la cadena de suministro militar de interrupciones o pérdidas debidas a incidentes de ciberseguridad. El CMMC especifica 17 dominios, cada uno de los cuales tiene un número variable de capacidades asociadas a él. La organización se califica por el nivel de madurez que se ha alcanzado para cada uno de los dominios. La CMMC certifica las organizaciones por nivel.

La NIST define cuatro pasos en respuesta a incidentes en un proceso de ciclo de vida: preparación, detección y análiis, contención, erradicación, recuperación, y actividades post incidente. El ciclo de vida de respuesta ante los incidentes pretende ser un proceso de aprendizaje reafirmante en el que cada incidente alimente el proceso para el manejo de futuros incidentes. La fase de preparación tiene lugar cuando se crea el CSIRT y se lo capacita. Esta fase ocurre cuando se adquieren e implementan las herramientas y los activos que serán necesarios para que el equipo investigue los incidentes. Los incidentes se detectan con muchos métodos diferentes y no todos son muy detallados ni claros. Hay dos categorías para los signos de un incidente: Precursor (un incidente puede ocurrir en el futuro) e Indicador (un incidente ha ocurrido o está sucediendo). El uso de algoritmos complejos y aprendizaje mecanizado ayuda, en ocasiones, a determinar la validez de los incidentes de seguridad. Un método que puede utilizarse es la creación de perfiles de la red y el sistema.

Cuando el CSIRT cree que se ha producido un incidente, debe realizar inmediatamente un análisis inicial para determinar el alcance de los hechos, por ejemplo, qué redes, sistemas o aplicaciones se vieron afectados, qué o quién originó el incidente y cómo está ocurriendo. Cuando se analiza y prioriza un incidente, el equipo de respuesta ante los incidentes debe notificar a las personas interesadas y partes externas para que todos los que necesitan involucrarse desempeñen sus funciones. Es fundamental disponer de documentación clara y concisa relativa a la preservación de la evidencia. La identificación de los atacantes no es tan importante como contener y erradicar el ataque, y recuperar los hosts y servicios. Después de la contención, el primer paso para la erradicación consiste en identificar todos los hosts que necesitan correcciones. Se deben eliminar todos los efectos del incidente de seguridad. También se deben aplicar correcciones o parches en todas las vulnerabilidades que el atacante aprovechó, de modo que el incidente no se repita. Después de manejar un incidente importante, la organización debe llevar a cabo una reunión de “lección aprendida” para examinar la eficacia del proceso de manejo de incidentes e identificar el fortalecimiento que hace falta en los controles y las prácticas vigentes de seguridad.